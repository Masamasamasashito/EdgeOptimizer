{
  "name": "eo-n8n-workflow-jp",
  "nodes": [
    {
      "parameters": {
        "content": "# è¨­å®š1 XMLã‚µã‚¤ãƒˆãƒãƒƒãƒ—URLè¨˜è¼‰\nStart by XML sitemapãƒãƒ¼ãƒ‰ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã€‚é‰›ç­†ãƒãƒ¼ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€XMLã‚µã‚¤ãƒˆãƒãƒƒãƒ—URLã‚’ä»¥ä¸‹ã®JSONã§æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚ã“ã®ãƒªãƒªãƒ¼ã‚¹ã§ã¯ã€XMLã‚µã‚¤ãƒˆãƒãƒƒãƒ—1å€‹ã—ã‹å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚\n```\n[\n    {\n        \"Website\" : \"https://sample.com/sitemap.xml\"\n    }\n]\n```\n\n# TXTãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹DNSèªè¨¼\n\n1. DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç™»éŒ²\nDNSã«ã¦ã€ä»¥ä¸‹TXTãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚\nãƒ»ãƒ›ã‚¹ãƒˆåã€€:ã€€_eo-auth.[ã‚ãªãŸã®ãƒ‰ãƒ¡ã‚¤ãƒ³]\nãƒ»å€¤ (å†…å®¹)ã€€:ã€€EX) eo-authorized-2025\n2. ã€Œ20 DNS Authã€ãƒãƒ¼ãƒ‰ã®ã€ŒDNSTXT_TOKENã€ã‚’ã€Œeo-authorized-2025ã€ã¨ç·¨é›†",
        "height": 640,
        "width": 486,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1184,
        1408
      ],
      "typeVersion": 1,
      "id": "619f22e9-073e-486f-b42a-f342bf471938",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "ç¬¬2éšå±¤XMLã‚µã‚¤ãƒˆ\nãƒãƒƒãƒ—URLã‚’å–å¾—",
        "height": 96,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -80,
        1904
      ],
      "typeVersion": 1,
      "id": "504c9364-096b-4dec-97c6-f228c8c14022",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "ç¬¬2éšå±¤XMLã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã®locã®URLé”ã«ç›´http(s)ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã„ã€\nWEBã‚µã‚¤ãƒˆé…ä¸‹ã«ã‚ã‚‹å€‹ã€…ã®WEBãƒšãƒ¼ã‚¸URLä¸€è¦§ã®åŸå‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—",
        "height": 80,
        "width": 502
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        544,
        1600
      ],
      "typeVersion": 1,
      "id": "28bc521c-7bf5-4adb-b467-a3fd5addadc1",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "WEBã‚µã‚¤ãƒˆé…ä¸‹ã®å…¨WEBãƒšãƒ¼ã‚¸URL\nã®jsonãƒªã‚¹ãƒˆã‚’ã“ã®ãƒãƒ¼ãƒ‰ã§å®Œæˆã€‚\n\nä½™åˆ†ãªãƒ‡ãƒ¼ã‚¿ã‚’é™¤å»ã€locã ã‘å–ã‚Šå‡ºã—ã€‚\nãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆhtml\nã®URLã ã‘jsonã‚’ä½œæˆ",
        "height": 144,
        "width": 294
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1248,
        1536
      ],
      "typeVersion": 1,
      "id": "20f2d098-80fc-47ec-8407-20d5982756fb",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "WEBã‚µã‚¤ãƒˆé…ä¸‹ã®å…¨WEBãƒšãƒ¼ã‚¸URLså…¨ã¦ã«ç›´ã§httpãƒªã‚¯ã‚¨ã‚¹ãƒˆ\nhttpãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—ã—ã€css,js,ç”»åƒ,ãƒ•ã‚©ãƒ³ãƒˆãªã©ã®ã‚µãƒ–ãƒªãƒ³ã‚¯ã‚’å«ã‚“ã ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—",
        "height": 80,
        "width": 592
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -784,
        2368
      ],
      "typeVersion": 1,
      "id": "b23f1f8e-d5dc-4b4e-98b8-36297302a89b",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "# è¨­å®š3 WARMUPã‚¿ãƒ¼ã‚²ãƒƒãƒˆURLãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹è¨­å®š\nâ‘ 140ã§URLä¸€è¦§ã‚’ãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ(html)URLã¨\nã‚¢ã‚»ãƒƒãƒˆ(css/js/ç”»åƒ/fonts)URLã§æ§‹æˆã•ã‚Œã‚‹jsonã¨ã—ã¦ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã§Cleaningã—ã¦ã„ã¾ã™ã€‚\nâ€»GA4ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„å¤–éƒ¨åºƒå‘Šãªã©ã€Warmupã‚¿ãƒ¼ã‚²ãƒƒãƒˆWebã‚¢ãƒ—ãƒªç®¡è½„ã§ã¯ãªã„CDNã‚’é™¤å¤–ã—ã¦ã„ã¾ã™ã€‚\nâ‘¡Start by XML sitemapãƒãƒ¼ãƒ‰ã§XMLã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã«ã—ãŸURL https://sample.comã€€ã‚’140ã«è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚Multi CDNãªã©ã§CDN Edge PoPã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ä»–ã®URLãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚‚ã‚ã‚‹å ´åˆã€è¿½è¨˜ã—ã¦ãã ã•ã„ã€‚\nâ‘¢Set(javascript)ã«ã‚ˆã‚‹é‡è¤‡æ’é™¤ã‚‚è¡Œã£ã¦ã„ã¾ã™ã€‚\n\nWarmupãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯¾è±¡URLè¨˜è¼‰ä¾‹ï¼‰\n```\nconst REQUEST_TARGET_URL_PREFIXES = [  \n  'https://sample.com', //Warmup RequestMain Target Url\n  'https://cdn-ileamdm.nitrocdn.com', // CDN Url\n];\n```",
        "height": 496,
        "width": 470,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        256,
        2144
      ],
      "typeVersion": 1,
      "id": "931439c8-c402-4f37-8120-bfca244eb137",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "content": "Pageã¨Assetã®åŒºåˆ†ã‚’ç„¡ãã—ã€å®Œå…¨ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªURLãƒªã‚¹ãƒˆã®jsonã‚’ä½œã‚‹",
        "height": 128,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        944,
        2592
      ],
      "typeVersion": 1,
      "id": "f2b83e76-13c6-421c-98a8-44767b8bfa0d",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "content": "ã‚¢ã‚»ãƒƒãƒˆURLã§\nï¼Ÿã¨# ã‚’å«ã‚€ã€€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„htmlã‚¢ãƒ³ã‚«ãƒ¼ãªã©ã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é™¤å»",
        "height": 128,
        "width": 176
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        736,
        2592
      ],
      "typeVersion": 1,
      "id": "6fcd3ca6-4aba-435b-ac27-dc728c05482b",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "content": "RequestEngineãŒWarmupãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹æ™‚ã«å¿…è¦ãªtokenã®ä½œæˆï¼ˆTargetUrlæ¯ï¼‰",
        "height": 176,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1872,
        2544
      ],
      "typeVersion": 1,
      "id": "8db9d58d-0910-4170-8ea9-aed3980f71c5",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "# è¨­å®š8 RequestEngineã®URLè¨­å®š\n \nRequest Engineã«Cache Warmup  ( Fetch / GETãƒªã‚¯ã‚¨ã‚¹ãƒˆ ) å®Ÿè¡Œå‘½ä»¤ã‚’n8nã‹ã‚‰httpãƒªã‚¯ã‚¨ã‚¹ãƒˆ\n\n- 280AWSã¯Lambdaé–¢æ•°åã¨ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ç­‰ã‚’è¨­å®š\n- 280CFã¯ã€Parametersã®URLã«Request Engine ã® Workerã®URLã‚’è¨­å®š\n- User-Agent ã‚’ 175 Assign UserAgents By UrlTypeã§ä»˜ä¸ã—ã¦ã„ã‚‹ãŸã‚ Parameters ã§ Send Headers ã® Header Parameters ã« User-Agent ã‚’ JSONã§ã€Expressionã¨ã—ã¦ {{ $json.data.headers[\"User-Agent\"] }} ã‚’è¿½åŠ ã—ã¦ã„ã‚‹\n- Accept-Language ã‚’ 180 Request Engine Settingsãƒãƒ¼ãƒ‰ã§ä»˜ä¸ã—ãŸå ´åˆã€Parameters ã§ Send Headers ã® Header Parameters ã« Accept-Language ã‚’ JSONã§ã€Expressionã¨ã—ã¦ {{ $json.data.headers[\"Accept-Language\"] }} ã‚’è¿½åŠ ã™ã‚‹\n- Parameters ã§ Send Body ã® options ã® timeoutãŒçŸ­ã„ã¨é€”ä¸­ã§æ­¢ã¾ã‚‹å ´åˆæœ‰ã‚Š\n- RequestEngineã‚’åœ°åŸŸåˆ¥ã‚„ã‚¯ãƒ©ã‚¦ãƒ‰åˆ¥ã§å¢—ã‚„ã™å ´åˆã€280ã¨ã—ã¦è¿½åŠ \n\n## ã‚¯ãƒ©ã‚¦ãƒ‰åˆ¥åŸºç›¤èªè¨¼ã¾ã¨ã‚\n- AWS Lambda\n    - IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã«ã‚ˆã‚‹èªè¨¼\n- Azure Functions\n    - é–¢æ•°ã‚­ãƒ¼ã«ã‚ˆã‚‹ x-functions-key ãƒ˜ãƒƒãƒ€ãƒ¼ã®èªè¨¼\n- Google CloudRun(ç¬¬3ä¸–ä»£)\n    - Oauth2 Bearerãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼ã®Authorizationã«ã‚ˆã‚‹èªè¨¼\n- Clodfare Worker\n    - Cloudflare Access ã‚µãƒ¼ãƒ“ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹ Header Auth(Custom Auth)èªè¨¼",
        "height": 592,
        "width": 1184,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1664,
        3600
      ],
      "typeVersion": 1,
      "id": "7c03ef61-84d3-442e-8fee-1bd35da9933d",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "content": "# è¨­å®š6 User-Agentä»˜ä¸\n\nWAFã‚’è€ƒæ…®ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®1ã¨2ã§åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ã†æ–¹ãŒæœ›ã¾ã—ã„ï¼ˆå¼¾ã‹ã‚Œã«ãã„ï¼‰\n\nâ€»UAç„¡ã—ã‚’æƒ³å®šã—ã¦ãªã„ãŸã‚ã€å¿…ãš1ã¤ä»¥ä¸ŠUAã‚’è¨­å®šã™ã‚‹ã“ã¨ã€‚\n\nURLã‚¿ã‚¤ãƒ—åˆ¥ã«User-Agentã‚’ä»˜ä¸\n1. asset â†’ ã‚¢ã‚»ãƒƒãƒˆç”¨UAãƒªã‚¹ãƒˆ\n2. main_document â†’ ãƒ¡ã‚¤ãƒ³ç”¨UAãƒªã‚¹ãƒˆ\n3. exception â†’ ç ´æ£„ï¼ˆå‡ºåŠ›ã—ãªã„ï¼‰",
        "height": 512,
        "width": 224,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2032,
        2208
      ],
      "typeVersion": 1,
      "id": "d1eabe69-6f90-4e98-a676-9540d7c80266",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "content": "jsonã«\nhttpãƒªã‚¯ã‚¨ã‚¹ãƒˆ\nãƒŠãƒ³ãƒãƒ¼è¿½åŠ ",
        "height": 80,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2640,
        2656
      ],
      "typeVersion": 1,
      "id": "cd855a89-4861-4baf-a7b0-542713e119cf",
      "name": "Sticky Note16"
    },
    {
      "parameters": {
        "content": "jsonæœ€ä¸Šä½ã«\ndataéšå±¤è¿½åŠ ",
        "height": 80,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2992,
        2656
      ],
      "typeVersion": 1,
      "id": "db378c9d-95f4-49eb-836f-1112b5d3ea67",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "content": "ã‚¢ã‚»ãƒƒãƒˆå«ã‚€\nURLä¸€è¦§ã«å¯¾ã—\nãƒ«ãƒ¼ãƒ—é–‹å§‹",
        "height": 80,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -736,
        3120
      ],
      "typeVersion": 1,
      "id": "e4b3c8bd-fe46-427f-b529-9062792dc930",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "content": "# è¨­å®š4 ä¸è¦URLãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®š\n/wp-json/ ã‚„ /xmlrpc.php ã‚„\n/feed/ ãªã©ã€Warmupä¸è¦URLã‚„ä¾‹å¤–URLã®é™¤å»\n\nNitroPackã®BlobURLã‚‚é™¤å¤–ã—ã¦ã„ã‚‹",
        "height": 336,
        "width": 230,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1120,
        2384
      ],
      "typeVersion": 1,
      "id": "0a767e2e-de5d-4f7c-bece-f515d02a1161",
      "name": "Sticky Note19"
    },
    {
      "parameters": {
        "content": "jsonã‹ã‚‰loc\nã ã‘ã‚’å–ã‚Šå‡ºã—\nurlã ã‘ã«ã™ã‚‹",
        "height": 80,
        "width": 166
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        320,
        1600
      ],
      "typeVersion": 1,
      "id": "e47ebd28-48a0-4044-836f-e54bd77c09e8",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "# 225 Request Engine Switcher\n\næœ¬ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹å±¤ã§ã™ã€‚URLã®é‡è¦åº¦ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã®ã‚³ã‚¹ãƒˆã€WAFã®å›é¿æˆ¦ç•¥ã®ã™ã¹ã¦ã‚’ã“ã“ã§çµ±åˆç®¡ç†ã¨ã—ã¦æ´»ã‹ã›ã¾ã™ã€‚ã€Œã©ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã€ã€Œã©ã“ã‹ã‚‰ã€ã€Œã©ã†é€ã‚‹ã‹ã€ã¨ã„ã†æœ€çµ‚åˆ¤æ–­ã‚’Switcherã«é›†ç´„ã§ãã¾ã™ã€‚å„ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆAWS, Azure, GCP, Cloudflareï¼‰ã®ç‰¹æ€§ã‚„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã¦ã€URLã‚„UAã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«æŒ¯ã‚Šåˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚\n\n- ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰GEOåˆ†æ•£CacheWarmupå¯èƒ½\n- WAFãƒã‚¤ãƒ‘ã‚¹ç”¨ã®RequestEngineç„¡ã—ã§ä½¿ã†å ´åˆã€280Direct Request ã ã‘åˆ©ç”¨ã—ã¦ãã ã•ã„\n\n1. 180ã®Request Engine Settingsã§ã€€type_areaã€€ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰ç¨®åˆ¥ã¨ã‚¨ãƒªã‚¢ï¼‰ã¨accept_languageã€€ã‚’è¨˜è¼‰/ç·¨é›†\n2. 225ã§Parametersã®Routing Rulesã«ã¦180ã®type_areaã‚’å¿…è¦ã«å¿œã˜ã¦è¿½è¨˜ã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¯ãƒ©ã‚¦ãƒ‰åˆ¥ã€ã‚¨ãƒªã‚¢åˆ¥ã®280ç³»RequestEngineã«Warmupãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æŒ‡ç¤ºå‡ºã—ã§GEOåˆ†æ•£ã¨ãªã‚‹ã€‚\n3. 280ç³»ãƒãƒ¼ãƒ‰ã‚’å¢—ã‚„ã™ã“ã¨ã§RequestEngineã‚’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã€ã‚¨ãƒªã‚¢åˆ¥ã§è‡ªç”±ã«å¢—æ¸›å¯èƒ½ï¼ˆGEOåˆ†æ•£ï¼†ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ï¼‰ã€‚\n\n# ã€å¿œç”¨ã€‘é«˜åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ä¾‹\n\n- ç‰¹å®šã®ãƒ‘ã‚¹ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã®é™¤å¤–ãƒ»å„ªå…ˆé€ä¿¡\n    - $json.data.url.includes('/lp/') ã®å ´åˆã ã‘ç‰¹å®šã®ãƒã‚¤ã‚¹ãƒšãƒƒã‚¯ãªRequest Engineï¼ˆä¾‹ï¼šCF Workersï¼‰ã«é£›ã°ã™ã€‚\n- ã‚¢ã‚»ãƒƒãƒˆç¨®åˆ¥ã«ã‚ˆã‚‹æŒ¯ã‚Šåˆ†ã‘\n    - $json.data.urltype == 'asset' ã‹ã¤æ‹¡å¼µå­ãŒ .js ã®ã‚‚ã®ã ã‘ã€JavaScriptå‡¦ç†ã«å¼·ã„ã‚¨ãƒ³ã‚¸ãƒ³ã«é£›ã°ã™ã€ã¨ã„ã£ãŸæœ€é©åŒ–ã€‚\n- ç‰¹å®šã®User-Agentã®ã¿ç‰¹å®šã‚¯ãƒ©ã‚¦ãƒ‰ã¸\n    - iOSç«¯æœ«ã®UAï¼ˆios_safariï¼‰ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ã¿ã€Appleã®CDN Edgeã«è¿‘ã„ã¨è¨€ã‚ã‚Œã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆä¾‹ï¼šAzureï¼‰ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡ºã™ã€ã¨ã„ã£ãŸUXæ¸¬å®šã€‚\n- æ™‚é–“å¸¯ã‚„ãƒ©ãƒ³ãƒ€ãƒ ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹é–“å¼•ã\n    - $json.data.httpRequestNumber % 2 == 0ï¼ˆå¶æ•°ç•ªå·ã®ã¿å®Ÿè¡Œï¼‰ãªã©ã¨ã—ã¦ã€å…¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®50%ã ã‘ã‚’æ¤œè¨¼ç”¨ã«å®Ÿè¡Œã™ã‚‹ã€‚\n- WAFã®ç‰¹å®šãƒ«ãƒ¼ãƒ«å›é¿ç”¨ï¼ˆç‰¹å®šUAã®ãƒ–ãƒ­ãƒƒã‚¯å›é¿ï¼‰\n    - ç‰¹å®šã®UAãŒç‰¹å®šã®ã‚¯ãƒ©ã‚¦ãƒ‰IPå¸¯åŸŸã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸå ´åˆã€ãã®çµ„ã¿åˆã‚ã›ã ã‘ã‚’ã€Œ280Direct Requestï¼ˆn8nç›´ï¼‰ã€ã«é€ƒãŒã™ã€‚\n- URLç¨®åˆ¥Ã—ã‚¨ãƒªã‚¢æœ€é©åŒ–ï¼šmain_document ã¯å…¨ã‚¨ãƒªã‚¢ã‹ã‚‰ã€asset ã¯ã‚³ã‚¹ãƒˆã®å®‰ã„ç‰¹å®šã®ã‚¨ãƒªã‚¢ï¼ˆä¾‹ï¼šCloudflareï¼‰ã‹ã‚‰ã®ã¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã€ã¨ã„ã£ãŸã‚³ã‚¹ãƒˆæœ€é©åŒ–ã€‚\n- ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å®Ÿè¡Œï¼šhttpRequestNumber ã‚’ç”¨ã„ãŸç®—è¡“æ¼”ç®—ï¼ˆä½™ã‚Šè¨ˆç®—ãªã©ï¼‰ã«ã‚ˆã‚Šã€è†¨å¤§ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã€Œä¸€éƒ¨ï¼ˆä¾‹ï¼š1/10ï¼‰ã€ã ã‘ã‚’æŠœãå‡ºã—ã¦ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰æ¤œè¨¼ã«ã‹ã‘ã‚‹ã€‚\n- ã€Œã‚¢ã‚»ãƒƒãƒˆã¯Cloudflareã§ä¸€æ‹¬å‡¦ç†ã—ã€ãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã ã‘å„ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰å¤šè§’çš„ã«å©ãã€ã¨ã„ã£ãŸã€ã‚³ã‚¹ãƒˆã¨ç²¾åº¦ã®ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ã‚‚215ã§å®Œçµã—ã¾ã™ã€‚\n- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå´ã®WAFç‰¹æ€§ã«åˆã‚ã›ã¦ã€ç‰¹å®šã®çµ„ã¿åˆã‚ã›ã‚’ã€Œé–“å¼•ãã€ã‚ã‚‹ã„ã¯ã€ŒDirectï¼ˆãƒ—ãƒ­ã‚­ã‚·ãªã—ï¼‰ã«é€ƒãŒã™ã€ã¨ã„ã£ãŸé˜²è¡›çš„ãªé‹ç”¨ãŒã€ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã§å¯èƒ½ã§ã™ã€‚\n\n## âš ï¸ é‡è¦ï¼šå¿œç”¨é©ç”¨æ™‚`httpRequestNumber`æ­¯æŠœã‘ï¼š\n\n- ç•ªå·ã®ä¸é€£ç¶šæ€§ï¼šSwitchãƒãƒ¼ãƒ‰ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é–“å¼•ãå ´åˆã€æœ€çµ‚çš„ãªå®Ÿè¡Œçµæœï¼ˆRequestResults.csvï¼‰ã«ãŠã„ã¦ httpRequestNumber ã¯**æ­¯æŠœã‘ï¼ˆé€£ç•ªã«ãªã‚‰ãªã„ï¼‰**çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚\n- ä»•æ§˜ï¼šã“ã‚Œã¯185ãƒãƒ¼ãƒ‰ã§å…¨çµ„ã¿åˆã‚ã›ã«å¯¾ã—ã¦äº‹å‰æ¡ç•ªã‚’è¡Œã£ã¦ã„ã‚‹ãŸã‚ã§ã‚ã‚Šã€æ¬ æã§ã¯ãªãã€Œãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸçµæœã€ã§ã™ã€‚\n- æ³¨æ„ï¼šurltype: asset ã¯ã€175ãƒãƒ¼ãƒ‰ã§æ—¢ã«UAãŒ1ã¤ã«çµã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¡ä»¶ã‚’å³ã—ãã—ã™ãã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ0ã«ãªã‚‹å¯èƒ½æ€§",
        "height": 1264,
        "width": 720
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1200,
        3456
      ],
      "typeVersion": 1,
      "id": "44bc6e04-61c7-41a0-86d8-398e77601828",
      "name": "Sticky Note22"
    },
    {
      "parameters": {
        "content": "ãƒ©ãƒ³ãƒ€ãƒ ã‚¹ãƒªãƒ¼ãƒ—\n1000ã€œ3999ms",
        "height": 80,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        912,
        1792
      ],
      "typeVersion": 1,
      "id": "3d078a4a-4d62-4f8d-9ae5-9584d315dff3",
      "name": "Sticky Note23"
    },
    {
      "parameters": {
        "content": "CACHE MISS / CACHE HIT ä¸€è¦§åŒ–ã€‚csvå‘ã‘ã«jsonãƒã‚¹ãƒˆã‚’ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã€‚",
        "height": 112,
        "width": 176
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1984,
        3056
      ],
      "typeVersion": 1,
      "id": "4e672e67-24e5-4423-baf4-d37fafbb95b9",
      "name": "Sticky Note25"
    },
    {
      "parameters": {
        "content": "ã‚¢ã‚»ãƒƒãƒˆï¼ãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ä¾‹å¤–åˆ†é¡\n\n1. ã‚¢ã‚»ãƒƒãƒˆã®æ‹¡å¼µå­(.css/.js/.jpg/.jpeg/.gif/.png/.webp/.avif/å„ç¨®ãƒ•ã‚©ãƒ³ãƒˆ)ãŒurlæœ«å°¾ã«æœ‰ã‚‹å ´åˆ\n`urltype: asset`\n2. ã‚¢ã‚»ãƒƒãƒˆæ‹¡å¼µå­ãŒ URL æœ«å°¾ã«ç„¡ã„ã€ã‚‚ã—ãã¯ /(ã‚¹ãƒ©ãƒƒã‚·ãƒ¥) ã‚‚ã—ãã¯ .html ã‚‚ã—ãã¯ .htm ã§ã‚ã‚‹å ´åˆ\n`urltype: main_document`\n3. ã‚¢ã‚»ãƒƒãƒˆã®æ‹¡å¼µå­ãŒurlæœ«å°¾ã«ç„¡ã2ã§ã‚‚ãªã„ä¾‹å¤–ã§ã‚ã‚‹å ´åˆ\n`urltype: exception`",
        "height": 336,
        "width": 246
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1376,
        2384
      ],
      "typeVersion": 1,
      "id": "df56bf7a-5079-406e-924e-a4a4ba0d6ad8",
      "name": "Sticky Note21"
    },
    {
      "parameters": {
        "content": "`urltype: exception`\nãŒtrueã®å ´åˆï¼ˆãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ãªãã€ã‚¢ã‚»ãƒƒãƒˆã§ã‚‚ãªãã€Warmupã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã¯ãªã„ï¼‰ã€ä¸€è¦§åŒ–å¯èƒ½ã€‚\n\n**é€šå¸¸ã¯falseã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç¶šè¡Œ**",
        "height": 256,
        "width": 182
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1648,
        2464
      ],
      "typeVersion": 1,
      "id": "209e2956-fd63-429b-8b2b-a42b93040548",
      "name": "Sticky Note27"
    },
    {
      "parameters": {
        "content": "# Step.1\n\nAsset Merge\n&\nFiltering\n&\nVariant\n\nHighâ€‘Precision \nTargetURLs \nCreator\n\n100ã‹ã‚‰199ãƒãƒ¼ãƒ‰",
        "height": 864,
        "width": 150,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1360,
        2112
      ],
      "typeVersion": 1,
      "id": "d54295f9-c995-4186-9f4f-ed71d3538950",
      "name": "Sticky Note34"
    },
    {
      "parameters": {
        "content": "# Step.2\n\nCache Warmup\n\n200ã‹ã‚‰399ãƒãƒ¼ãƒ‰\n\nâ€»Step.3ã ã‘ãƒãƒ¼ãƒ‰ãƒŠãƒ³ãƒãƒ¼ã®ãƒ¬ãƒ³ã‚¸åºƒã„",
        "height": 1824,
        "width": 150,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1360,
        3120
      ],
      "typeVersion": 1,
      "id": "b3236e90-9dbd-44c4-bfb0-b65a5bcf1ba0",
      "name": "Sticky Note35"
    },
    {
      "parameters": {
        "content": "# â–¶ Edge Optimizer\n  \nCreated by ã«ã—ãƒ©ãƒœ [https://4649-24.com](https://4649-24.com)\n    \n# åˆ©ç”¨æ‰‹é †\n\n## 1. self-hosted n8n ä½œæˆ\n\n- https://github.com/Masamasamasashito/EdgeOptimizer\n- env.exampleã‚’è¤‡è£½ã€å„ç¨®ã®å€¤ã‚’è¨­å®šã€‚\n- n8n work flow jsonã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\n- æ¡ƒè‰²ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ãƒãƒ¼ãƒˆã«ã—ãŸãŒã£ã¦å„ç¨®è¨­å®š\n\n## 2. ç…§åˆç”¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®š\n\n## 3. ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§Request Engineä½œæˆ\n\n- ã‚¯ãƒ©ã‚¦ãƒ‰åˆ¥ã®èªè¨¼è¨­å®š\n    - AWS Lambdaã€Azure Functionsã€GCP CloudRunã€Cloudflare Workers\n    - å¯¾è±¡WEBã‚µã‚¤ãƒˆã®ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ãƒšãƒ«ã‚½ãƒŠã‹ã‚‰ä¸€ç•ªè¿‘ã„CDNã®Edgeãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é¸æŠãŒæ¨å¥¨ã•ã‚Œã¾ã™\n    - å¯¾è±¡WEBã‚µã‚¤ãƒˆã®CDNã‚’å•ã‚ãšä½¿ãˆã¾ã™ã€‚\n    - ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãŒç•°ãªã‚‹äº‹ã‚’æƒ³å®šã—ã€AWS, Azure, GCP, Cloudflareã®ã„ãšã‚Œã‹ã‚’ä½¿ãˆã¾ã™ã€‚\n\n## 3. Github workflowã®èªè¨¼å‘ã‘ Repository secrets è¨­å®š\n\n- github > settings > Secret and Variables > action > Repository secrets ä½œæˆ\n\n## 4. ã‚µãƒ¼ãƒãƒ¬ã‚¹ã§ä½¿ã†ç…§åˆç”¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®è¨­å®š\n\n- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãŒç•°ãªã‚‹äº‹ã‚’æƒ³å®šã—ã€AWS, Azure, GCP, Cloudflareã®ã„ãšã‚Œã‹ã‚’ä½¿ãˆã¾ã™ã€‚\n\n\n\n## 2. self-hosted n8nç’°å¢ƒã®æ§‹ç¯‰ã¨èµ·å‹•\n\næ‰‹é †ã¯ã€ä»¥ä¸‹ã«ã¦ã€‚\nhttps://github.com/Masamasamasashito/edge-vero-optimizer\n  \n### 3. self-hosted n8n ã« signup\n  \nn8nã®license keyã«ã‚ˆã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚ç„¡æ–™ã§å‡ºæ¥ã¾ã™ã€‚\n  \n### 4. n8n workflow JSON templateã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\n  \nCreate workflow > Import from file >  eo-xmlsitemap-jp.json ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\n  \n### 5. èƒŒæ™¯ãƒ”ãƒ³ã‚¯Sticky Noteã«ã—ãŸãŒã£ã¦å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¦ãã ã•ã„\n\n### 6. ã€Œ420 JSON to WarmupHistoryCSVã€ãƒãƒ¼ãƒ‰ã®ã€ŒExecute Stepã€ã‚’æŠ¼ä¸‹ã—ã¦Warmupã‚’é–‹å§‹ã—ã¦ãã ã•ã„\n\n### 7. Warmupå®Œäº†å¾Œã€ã€Œ420ã€ãƒãƒ¼ãƒ‰ã§downloadã‚’æŠ¼ä¸‹ã—ã€RequestResults_YYYYMMDD.csvã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„\n\n### 8. RequestResults_YYYYMMDD.csvã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€æœ€çµ‚è¡Œã®å³ä¸‹ã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆURLå…¨ä½“ã«å¯¾ã™ã‚‹Cache Hitç‡ãªã©ã‚’ç¢ºèªå‡ºæ¥ã¾ã™ã€‚\n\n## Warning\n\n1. æœ€çµ‚ãƒãƒ¼ãƒ‰ã®Execute Stepã‚’æŠ¼ã—ã¦Warmupã‚’é–‹å§‹ã—ã¦ãã ã•ã„\n2. self-hosted n8nã§Workflowå®Ÿè¡Œä¸­ã€n8nãƒ­ã‚°ã‚¤ãƒ³ç”»é¢å†…ã§ä»–ã®ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹ã¨Workflowã¯æ­¢ã¾ã‚Šã¾ã™\n3. `.env`ã®éå…¬é–‹æƒ…å ±ãŒæ¼æ´©ã—ãªã„ã‚ˆã†ã«æ³¨æ„\n   - `.env`ã¯å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã« push ã—ãªã„ã§ãã ã•ã„\n   - docker-compose.yml ã‚„å„ãƒãƒ¼ãƒ‰ã‚„Sticky Noteã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç›´ã§æ›¸ã‹ãªã„ã§ãã ã•ã„\n   - .gitignore ã«ã¯ .env ã‚’å¿…ãšè¨˜è¼‰ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™\n4. docker image ã‚’ latest ã‚„ alpine ã¨ã—ã¦ã„ã¾ã™\n   - å¿…è¦ã«å¿œã˜ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å›ºå®šã—ã¦ãã ã•ã„\n\n## IMPORTANT\n\nã“ã® n8n workflow JSON template ã¯ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–ã¨ UX æ”¹å–„ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€WAF ã‚„ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆãªã©ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’å›é¿ã™ã‚‹ç”¨é€”ã§ã®åˆ©ç”¨ã¯ç¦æ­¢ã—ã¾ã™\n\n## Requirements\n\nã“ã®n8n workflow JSON templateã¯ã€ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ Request Engine ã¨ãªã‚‹Serverless Proxy / Fetcher ã¨ã€[sitemaps.org](https://www.sitemaps.org/)æº–æ‹ ã®XMLã‚µã‚¤ãƒˆãƒãƒƒãƒ—ï¼ˆæœ€å¤§ 2 éšå±¤ï¼‰ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚",
        "height": 1232,
        "width": 1488,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "769a995e-8a9b-4fc4-ad2a-fbae2cba6595",
      "name": "Sticky Note29"
    },
    {
      "parameters": {
        "content": "ãƒ©ãƒ³ãƒ€ãƒ ã‚¹ãƒªãƒ¼ãƒ—\n1000ã€œ3999ms",
        "height": 80,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -416,
        2592
      ],
      "typeVersion": 1,
      "id": "37f23293-5729-4630-a92d-7051facbcc46",
      "name": "Sticky Note24"
    },
    {
      "parameters": {
        "content": "ãƒ©ãƒ³ãƒ€ãƒ ã‚¹ãƒªãƒ¼ãƒ—\n1000ã€œ3999ms",
        "height": 80,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1968,
        4288
      ],
      "typeVersion": 1,
      "id": "bb4a0d92-22fe-4077-bfb5-987a0901285c",
      "name": "Sticky Note30"
    },
    {
      "parameters": {
        "content": "Step. 2ã®çµ„ã¿åˆã‚ã›çˆ†ç™ºã«æ³¨æ„ãŒå¿…è¦ã€‚å¤§é‡HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é †æ¬¡å‡¦ç†ã™ã‚‹å ´åˆã€å®Ÿè¡Œæ™‚é–“ãŒæ•°æ™‚é–“ã«åŠã¶ã€n8nå®Ÿè¡Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚„ã‚µãƒ¼ãƒãƒ¼ã‚³ã‚¹ãƒˆå¢—ã€ãƒ¡ãƒ¢ãƒªæ¯æ¸‡ã«æ³¨æ„ã€‚\n\nå¯¾ç­–ã¨ã—ã¦ã€ã‚­ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹n8nè¦ªå­ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãªã©ã€‚",
        "height": 176,
        "width": 352
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -144,
        2688
      ],
      "typeVersion": 1,
      "id": "6db2343f-2d69-45d3-bbec-fcf0ea77c293",
      "name": "Sticky Note39"
    },
    {
      "parameters": {
        "content": "# è¨­å®š7 Request Engineç¨®åˆ¥/ã‚¨ãƒªã‚¢/è¨€èªã®è¨­å®š\n\n- AWS Lambda/æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³/æ—¥æœ¬èª\n- Cloudflare Workers/global/æ—¥æœ¬èª\n- AWS Lambda/æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³/Nothing\n  \nãªã©\n\n280ç³»ãƒãƒ¼ãƒ‰ã§è¨­å®šã‚’åˆã‚ã›ã‚‹å¿…è¦ã‚ã‚Š",
        "height": 384,
        "width": 358,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2272,
        2336
      ],
      "typeVersion": 1,
      "id": "85bbc650-ba19-44b0-84bc-5892c43d20e3",
      "name": "Sticky Note18"
    },
    {
      "parameters": {
        "content": "# Step.0\n\nMainDocument\nTarget\nUrLs\nCreator\n\n1ã‹ã‚‰99ãƒãƒ¼ãƒ‰",
        "height": 592,
        "width": 150,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1360,
        1472
      ],
      "typeVersion": 1,
      "id": "8f055662-ff5a-4eb1-9137-bf7f4434583f",
      "name": "Sticky Note38"
    },
    {
      "parameters": {
        "content": "# èª²é¡Œ6\n\nç‰¹ã«280ç³»ãƒãƒ¼ãƒ‰ã®RequestEngineå´ã§ã€é …ç›®æ•´é “ãŒå¿…è¦ã€‚RequestHistoryã®CSVã§ãƒ‡ãƒ¼ã‚¿è§£æå‘ã‘ã«ä½¿ã„ã‚„ã™ãã™ã‚‹å¿…è¦æœ‰ã‚Šã€‚n8nãƒãƒ¼ãƒ‰æ¡ç•ªã¸ã®å½±éŸ¿ã¯å°ã•ã„ãŸã‚ã€å„ªå…ˆé †ä½ä½",
        "height": 192,
        "width": 304,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1520,
        3376
      ],
      "typeVersion": 1,
      "id": "63e377e1-462d-42ac-92bc-70c35a3a4716",
      "name": "Sticky Note41"
    },
    {
      "parameters": {
        "content": "BigQuery / Looker Studio / ç”ŸæˆAIã€etcã€å¤šæ§˜ãªåˆ†æ&æœ€é©åŒ–ã¸ã®æ´»ç”¨å¯èƒ½",
        "height": 112,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        3040
      ],
      "typeVersion": 1,
      "id": "b97a1799-41c3-409a-9e27-e37818ced8c9",
      "name": "Sticky Note26"
    },
    {
      "parameters": {
        "content": "# èª²é¡Œ4\n\n170 n8n RequestSecret Token Generator ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ã†ãƒˆãƒ¼ã‚¯ãƒ³ç…§åˆãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã‹ã€æ¤œè¨¼ã™ã¹ã\nå„ã‚¯ãƒ©ã‚¦ãƒ‰ã®èªè¨¼æ©Ÿèƒ½ã§n8nã®Credentialsæ©Ÿèƒ½ã«ã‚ˆã‚‹RequestEngineæ¥ç¶šèªè¨¼ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã«å¯¾ã™ã‚‹ä¸æ­£æ¥ç¶šæ‹’å¦ã®æ‹…ä¿ã¯ã‚ã‚‹ãŒã€Warmupãƒªã‚¯ã‚¹ã¨å®Ÿè¡Œç›´å‰ãƒˆãƒ¼ã‚¯ãƒ³ç…§åˆã‚‚ç²¾åº¦ã‚’ä¸Šã’ã¦ãŠãã¹ãã€‚\n\n## 170 n8n RequestSecret Token Generatorãƒãƒ¼ãƒ‰\nself hosted ç‰ˆ n8n ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®šã€‚åŒãƒãƒ¼ãƒ‰ Parametersã®Valueã«ä»¥ä¸‹ã‚’è¨˜è¼‰\n\n```\n{{ $json.url }}{{ $env.N8N_EO_REQUEST_SECRET }}\n```\nâ€»EO_Infra_Docker/.env ï¼ˆenv.exampleï¼‰ã€€ã‚’æ­£ã—ãä½œæˆã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™",
        "height": 368,
        "width": 848,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2320,
        1904
      ],
      "typeVersion": 1,
      "id": "fe349ff5-12c0-40d6-9b5e-03ed6dc71329",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "210 Step.2 Separete Starter Dummy\nç›´å‰ã®itemæ•°ãŒTotal Warmupãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°",
        "height": 112
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3168,
        2608
      ],
      "typeVersion": 1,
      "id": "272c364c-c4a3-4d1a-89ec-71d079806a55",
      "name": "Sticky Note20"
    },
    {
      "parameters": {
        "content": "# è¨­å®š2\n\n`125-1 HTTP Req to Get All TargetUrls through Playwright Container`\nã§ Playwrightã«ã‚ˆã‚‹ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆdockerã§åˆ¥ã‚³ãƒ³ãƒ†ãƒŠï¼‰ã‚’ä½¿ã‚ãªã„å ´åˆ\n`125-2 Direct HTTP Req to All Web Page Urls`\nã«å…¥ã‚Œæ›¿ãˆ\n\n**Target URLãƒªã‚¹ãƒˆæŠ½å‡ºç¶²ç¾…æ€§ã¯ä¸‹ãŒã‚Šã¾ã™**",
        "height": 528,
        "width": 320,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1168,
        2224
      ],
      "typeVersion": 1,
      "id": "c2504584-80a1-4483-8ddc-9142f2f816ad",
      "name": "Sticky Note32"
    },
    {
      "parameters": {
        "content": "# è¨­å®š9ã€GCFã‚’RequestEngineã§ä½¿ã†å ´åˆã€‘\n\n235 Get IDtoken From GCP Service Account Access Token ã®è¨­å®š\n\nGCPã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®JSON Keyã‚’n8n Credentialsã§`Google Service Account API`ã‚’ä½¿ã£ã¦ç™»éŒ²ã€‚Authenticationã§`Google Service Account API`ã®è©²å½“ã®Credentialã‚’è¨­å®šã™ã‚‹\n\n## Credentialsç™»éŒ²æ‰‹é †\n\nã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®JSONã‚­ãƒ¼å–å¾—ãŒçµ‚ã‚ã£ã¦ã„ã‚‹ã“ã¨ï¼\n\n1. n8n Credentials ã® Google Service Account API ã‚’ä½¿ã†\n2. Service Account Email ã« ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ï¼ˆJSONã‚­ãƒ¼å†…ã®client_emailï¼‰ã‚’å…¥åŠ›\n3. Private Key ã« private_keyã‚’ãã®ã¾ã¾å…¥åŠ›\n4. Set up for use in HTTP Request node ã‚’æœ‰åŠ¹åŒ–\n5. Scope(s) ã« IAMã ã‘ã‚’ã‚¹ã‚³ãƒ¼ãƒ—ã¨ã™ã‚‹ãŸã‚https://www.googleapis.com/auth/iamã‚’å…¥åŠ›\n5. Save",
        "height": 544,
        "width": 672,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -352,
        4448
      ],
      "typeVersion": 1,
      "id": "ef975fc9-0dd9-4092-a675-d45c04924651",
      "name": "Sticky Note44"
    },
    {
      "parameters": {
        "content": "# 115 INPUT json Format Sample For  Step.1\n\nStep.1ã‹ã‚‰é–‹å§‹ã™ã‚‹å ´åˆã€\n1. 75ã¨115ã‚’åˆ†é›¢\n2. 110ã®ã‚³ãƒ¼ãƒ‰ã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆURLã‚’è¨˜è¼‰ã—ã€110å¾Œæ–¹ã‹ã‚‰115å‰æ–¹ã«æ¥ç¶š\n3. 110ã ã‘å®Ÿè¡Œ\n4. 360 JSON to WarmupHistoryCSVã‚’å®Ÿè¡Œ\n```\n[\n\t{\n\t\t\"loc\":\"https://sample.com/information/\"\n\t},\n\t{\t\n\t\t\"loc\":\"https://sample.com/ãŠçŸ¥ã‚‰ã›/site-renewal/\"\n\t},\n\t{\n\t\t\"loc\":\"https://sample.com/\"\n\t},\n\t{\n\t\t\"loc\":\"https://sample.com/category/ãŠçŸ¥ã‚‰ã›/\"\n\t},\n\t{\n\t\t\"loc\":\"https://sample.com/author/nissy02/\"\n\t}\n]\n```",
        "height": 560,
        "width": 736
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2304,
        1200
      ],
      "typeVersion": 1,
      "id": "24991ff2-aca2-4256-9d9e-f9115c773cfe",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "# 210 INPUT json Format Sample For Step.2\n\nã€é‡è¦ã€‘170 n8n RequestSecret Token Generator ã‚’ä½¿ã‚ãªã„ãŸã‚ã€Secret Key Token æ‰‹å‹•ç”ŸæˆãŒå¿…è¦ã§ã‹ãªã‚Šå¤§å¤‰ã€‚\nãã®ãŸã‚ã€Step.2åˆ†é›¢ç”¨ã‚¹ã‚¿ãƒ¼ãƒˆãƒãƒ¼ãƒ‰æœªä½œæˆã€‚\n\n```\n[\n  {\n    \"data\": {\n      \"targetUrl\": \"https://sample.com/\",\n      \"urltype\": \"main_document\",\n      \"tokenCalculatedByN8n\": \"AAAAAAAAAAAAAAAAAAAAAAA\",\n      \"headers\": {\n        \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1\",\n        \"Accept-Language\": \"ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7\"\n      },\n      \"userAgentLabel\": \"ios_safari_17\",\n      \"cloud_type_area\": \"AwsLambda_ap-northeast-1\",\n      \"httpRequestNumber\": 5\n    }\n  },\n  {\n    \"data\": {\n      \"targetUrl\": \"https://sample.com/\",\n      \"urltype\": \"main_document\",\n      \"tokenCalculatedByN8n\": \"BBBBBBBBBBBBBBBBBBBBBBBBBBBB\",\n      \"headers\": {\n        \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1\",\n        \"Accept-Language\": \"ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7\"\n      },\n      \"userAgentLabel\": \"ios_safari_17\",\n      \"cloud_type_area\": \"AzureFunctions_japaneast\",\n      \"httpRequestNumber\": 6\n    }\n  },\n  {\n    \"data\": {\n      \"targetUrl\": \"https://sample.com/\",\n      \"urltype\": \"main_document\",\n      \"tokenCalculatedByN8n\": \"CCCCCCCCCCCCCCCCCCCCCCCCCCCC\",\n      \"headers\": {\n        \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1\",\n        \"Accept-Language\": \"ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7\"\n      },\n      \"userAgentLabel\": \"ios_safari_17\",\n      \"cloud_type_area\": \"CloudflareWorker_global\",\n      \"httpRequestNumber\": 7\n    }\n  },\n  {\n    \"data\": {\n      \"targetUrl\": \"https://sample.com/\",\n      \"urltype\": \"main_document\",\n      \"tokenCalculatedByN8n\": \"DDDDDDDDDDDDDDDDDDDDDDDDDDDDDD\",\n      \"headers\": {\n        \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1\",\n        \"Accept-Language\": \"ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7\"\n      },\n      \"userAgentLabel\": \"ios_safari_17\",\n      \"cloud_type_area\": \"GcpCloudFunctions_asia-northeast1\",\n      \"httpRequestNumber\": 8\n    }\n  },\n  {\n    \"data\": {\n      \"targetUrl\": \"https://sample.com/wp-includes/js/jquery/jquery.min.js\",\n      \"urltype\": \"asset\",\n      \"tokenCalculatedByN8n\": \"EEEEEEEEEEEEEEEEEEEEEEEEEEEEEE\",\n      \"headers\": {\n        \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1\",\n        \"Accept-Language\": \"ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7\"\n      },\n      \"userAgentLabel\": \"ios_safari_17\",\n      \"cloud_type_area\": \"AwsLambda_ap-northeast-1\",\n      \"httpRequestNumber\": 9\n    }\n  },\n  {\n    \"data\": {\n      \"targetUrl\": \"https://sample.com/wp-includes/js/jquery/jquery.min.js\",\n      \"urltype\": \"asset\",\n      \"tokenCalculatedByN8n\": \"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF\",\n      \"headers\": {\n        \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1\",\n        \"Accept-Language\": \"ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7\"\n      },\n      \"userAgentLabel\": \"ios_safari_17\",\n      \"cloud_type_area\": \"AzureFunctions_japaneast\",\n      \"httpRequestNumber\": 10\n    }\n  },\n  {\n    \"data\": {\n      \"targetUrl\": \"https://sample.com/wp-includes/js/jquery/jquery.min.js\",\n      \"urltype\": \"asset\",\n      \"tokenCalculatedByN8n\": \"GGGGGGGGGGGGGGGGGGGGGGGGGG\",\n      \"headers\": {\n        \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1\",\n        \"Accept-Language\": \"ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7\"\n      },\n      \"userAgentLabel\": \"ios_safari_17\",\n      \"cloud_type_area\": \"CloudflareWorker_global\",\n      \"httpRequestNumber\": 11\n    }\n  },\n  {\n    \"data\": {\n      \"targetUrl\": \"https://sample.com/wp-includes/js/jquery/jquery.min.js\",\n      \"urltype\": \"asset\",\n      \"tokenCalculatedByN8n\": \"HHHHHHHHHHHHHHHHHHHHHHHHHHHHH\",\n      \"headers\": {\n        \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1\",\n        \"Accept-Language\": \"ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7\"\n      },\n      \"userAgentLabel\": \"ios_safari_17\",\n      \"cloud_type_area\": \"GcpCloudFunctions_asia-northeast1\",\n      \"httpRequestNumber\": 12\n    }\n  }\n]\n```",
        "height": 1312,
        "width": 1392
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3216,
        1536
      ],
      "typeVersion": 1,
      "id": "617e16aa-3b02-42d7-83d0-4750b7af9d25",
      "name": "Sticky Note46"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -752,
        2432
      ],
      "id": "b218b458-a582-4376-83af-385595cb99dd",
      "name": "120 Loop Over All Web Page Urls"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://playwright:13000/content",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "url",
              "value": "={{ $json.loc }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "neverError": true
            }
          },
          "timeout": 120000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -576,
        2560
      ],
      "id": "1dcfa815-12eb-4daf-b697-3565b0456125",
      "name": "125-1 HTTP Req to Get All TargetUrls through Playwright Container",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "const delay = Math.floor(Math.random() * 3000) + 1000; // 1000ã€œ3999ms\nawait new Promise(r => setTimeout(r, delay));\nreturn [{ json: { ...$json, waitSeconds: delay / 1000 } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -400,
        2656
      ],
      "id": "d861abfe-d33d-4612-b9b4-0776b7daa36c",
      "name": "130 Random Sleep (ms)",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "url": "={{ $json.loc }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true,
              "responseFormat": "text",
              "outputPropertyName": "html"
            }
          },
          "timeout": 180000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1088,
        2512
      ],
      "id": "7432106d-093d-4f57-824e-aba83cd30ac2",
      "name": "125-2 Direct HTTP Req to All Web Page Urls"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -64,
        2400
      ],
      "id": "d8a0bdd4-6e05-445d-a238-82bdcf67d694",
      "name": "135 Merge Assets to URLs"
    },
    {
      "parameters": {
        "jsCode": "const out = [];\n\n// -----------------------------------------------------------\n// ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚¨ãƒªã‚¢\n// -----------------------------------------------------------\n\n// Warmupå¯¾è±¡ã¨ã™ã‚‹URLãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹\nconst REQUEST_TARGET_URL_PREFIXES = [\nÂ  //'https://sample.com'\n  // â†“ ãƒ€ãƒ–ãƒ«CDNç­‰ã®å ´åˆ\nÂ  //'https://cdn-ileamdm.nitrocdn.com',\n];\n\n// ç„¡è¦–ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ \nconst IGNORE_SCHEMES = ['javascript:', 'mailto:', 'tel:', 'data:', '#'];\n\n// -----------------------------------------------------------\n// å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯\n// -----------------------------------------------------------\n\n// 1. item ã‹ã‚‰ loc (ãƒšãƒ¼ã‚¸URL) ã‚’å–ã‚Šå‡ºã™\nfunction getLoc(item) {\nÂ  return item.json?.loc || item.loc || null;\n}\n\n// 2. item ã‹ã‚‰ HTMLæœ¬æ–‡ ã‚’å–ã‚Šå‡ºã™\nfunction getHtmlDoc(item) {\n  // === ğŸš€ ä¿®æ­£ç®‡æ‰€: Playwright APIã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã«å¯¾å¿œ ===\n  // 1. Playwright APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (item.json.response.html) ã‹ã‚‰HTMLã‚’å–å¾—\n  if (typeof item.json?.response?.html === 'string') return item.json.response.html;\n  // =======================================================\n  \nÂ  if (typeof item.json?.html === 'string') return item.json.html; // æ—¢å­˜ã®115ãƒãƒ¼ãƒ‰äº’æ›æ€§\nÂ  if (typeof item.json?.data === 'string') return item.json.data;\nÂ  return '';\n}\n\n// å¯¾è±¡URLã‹ã©ã†ã‹åˆ¤å®š\nfunction isTargetUrl(url) {\nÂ  if (!url) return false;\nÂ  // ã‚¹ã‚­ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯\nÂ  if (IGNORE_SCHEMES.some(sch => url.startsWith(sch))) return false;\nÂ  // ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒã‚§ãƒƒã‚¯\nÂ  return REQUEST_TARGET_URL_PREFIXES.some(prefix => url.startsWith(prefix));\n}\n\n// -----------------------------------------------------------\n// æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³\n// -----------------------------------------------------------\n\n// A. ã€çµ¶å¯¾ãƒ‘ã‚¹ç”¨ã€‘ http(s)://ã§å§‹ã¾ã‚‹æ–‡å­—åˆ—ã‚’ç„¡å·®åˆ¥ã«æ‹¾ã†\n// æ³¨æ„: PlaywrightãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸDOMã‹ã‚‰ã€data-srcãªã©ã§ã¯ãªã„æœ€çµ‚çš„ãªURLã‚’æŠ½å‡º\nconst absoluteUrlPattern = /https?:\\/\\/[^\\s\"'()<>]+/g;\n\n// B. ã€ç›¸å¯¾ãƒ‘ã‚¹ç”¨ã€‘ href=\"...\" ã¾ãŸã¯ src=\"...\" ã®ä¸­èº«ã‚’æ‹¾ã†\nconst relativePathPattern = /(?:href|src)\\\\s*=\\\\s*([\\\"'])(.*?)\\\\1/gi;\n\n\n// -----------------------------------------------------------\n// ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—\n// -----------------------------------------------------------\n\nfor (const item of items) {\nÂ  const pageUrl = getLoc(item);\nÂ  const html = getHtmlDoc(item); // ä¿®æ­£ã•ã‚ŒãŸé–¢æ•°ã‚’ä½¿ç”¨\nÂ  const assetsSet = new Set(); // é‡è¤‡æ’é™¤ç”¨Set\n\nÂ  if (pageUrl && html.length > 0) {\n\nÂ  Â  // --- æˆ¦ç•¥A: çµ¶å¯¾ãƒ‘ã‚¹ã®æŠ½å‡º ---\nÂ  Â  let match;\nÂ  Â  while ((match = absoluteUrlPattern.exec(html)) !== null) {\nÂ  Â  Â  const rawUrl = match[0];\nÂ  Â  Â  \nÂ  Â  Â  // ã“ã“ã§ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é™¤å»ã¯è¡Œã‚ãªã„ï¼ˆNode 15ã®è²¬å‹™ï¼‰\nÂ  Â  Â  if (isTargetUrl(rawUrl)) {\nÂ  Â  Â  Â  assetsSet.add(rawUrl);\nÂ  Â  Â  }\nÂ  Â  }\n\nÂ  Â  // --- æˆ¦ç•¥B: ç›¸å¯¾ãƒ‘ã‚¹ã®æŠ½å‡ºã¨çµåˆ ---\nÂ  Â  relativePathPattern.lastIndex = 0;\n\nÂ  Â  while ((match = relativePathPattern.exec(html)) !== null) {\nÂ  Â  Â  const rawVal = match[2]; // ã‚¯ã‚©ãƒ¼ãƒˆã®ä¸­èº«\nÂ  Â  Â  \nÂ  Â  Â  try {\nÂ  Â  Â  Â  // ãƒ™ãƒ¼ã‚¹URL(pageUrl)ã‚’ä½¿ã£ã¦çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›\nÂ  Â  Â  Â  const resolvedUrlObj = new URL(rawVal, pageUrl);\nÂ  Â  Â  Â  const resolvedUrl = resolvedUrlObj.href;\n\nÂ  Â  Â  Â  if (isTargetUrl(resolvedUrl)) {\nÂ  Â  Â  Â  Â  assetsSet.add(resolvedUrl);\nÂ  Â  Â  Â  }\nÂ  Â  Â  } catch (e) {\nÂ  Â  Â  Â  continue;\nÂ  Â  Â  }\nÂ  Â  }\nÂ  }\n\nÂ  out.push({\nÂ  Â  json: {\nÂ  Â  Â  pageUrl: pageUrl,\nÂ  Â  Â  assetUrls: Array.from(assetsSet),\nÂ  Â  Â  count: assetsSet.size\nÂ  Â  },\nÂ  });\n}\n\nreturn out;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        2752
      ],
      "id": "e67b621b-2ff4-4ce4-a68b-3e39d252a121",
      "name": "140 Extract Warmup Page Assets"
    },
    {
      "parameters": {
        "jsCode": "// pageUrl / assetUrls ã®URLã‹ã‚‰ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ–‡å­—åˆ— ã¨ ã‚¢ãƒ³ã‚«ãƒ¼ ã‚’å‰Šã‚Šãƒ™ãƒ¼ã‚¹URLã ã‘ã«ã™ã‚‹\n// æ§‹é€ ã¨é †ç•ªã¯ç¶­æŒã€é‡è¤‡æ’é™¤ã—ãªã„\n\n// URLæ­£è¦åŒ–é–¢æ•°ï¼ˆ? / # ä»¥é™ã‚’å‰Šã‚‹ï¼‰\nfunction stripQueryAndAnchor(raw) {\n  if (typeof raw !== 'string' || raw.length === 0) return raw;\n\n  try {\n    // æ§‹æ–‡è§£æã€‚æ­£è¦URLãªã‚‰ origin + pathname ã ã‘æ®‹ã™\n    const parsedUrl = new URL(raw);\n    return parsedUrl.origin + parsedUrl.pathname;\n  } catch {\n    // è§£æã§ããªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€? ã¨ # ã‚’æ¢ã—ã¦ãã‚Œã‚ˆã‚Šã‚‚å‰ã ã‘ã‚’è¿”ã™\n    const queryOrAnchorIndex = raw.search(/[?#]/);\n    if (queryOrAnchorIndex === -1) return raw;\n    return raw.slice(0, queryOrAnchorIndex);\n  }\n}\n\nconst out = [];\n\nfor (const item of items) {\n  const jsonData  = item.json || {};\n\n  //ãƒšãƒ¼ã‚¸URLå–å¾—\n  const pageUrl = jsonData .pageUrl;\n  //ã‚¢ã‚»ãƒƒãƒˆURLç¾¤å–å¾—\n  const assetUrlList = Array.isArray(jsonData .assetUrls) ? jsonData .assetUrls : [];\n  //URLæ­£è¦åŒ–\n  const cleanedPageUrl = stripQueryAndAnchor(pageUrl);\n  const cleanedAssetUrls = assetUrlList.map(stripQueryAndAnchor);\n\n  out.push({\n    json: {\n      // ä»–ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Œã°ç¶­æŒã—ãŸã„å ´åˆã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰\n      // ...jsonData ,\n      pageUrl: cleanedPageUrl,\n      assetUrls: cleanedAssetUrls,\n    },\n  });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        784,
        2752
      ],
      "id": "5f4ea42b-2635-4c32-b832-8e459f2aff99",
      "name": "145 Query Param and Anchor Filter",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "// URLã«ã¤ã„ã¦ã€Pageã¨ã‚¢ã‚»ãƒƒãƒˆã®åŒºåˆ†ã‚’ç„¡ãã—ã€å®Œå…¨ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªURLãƒªã‚¹ãƒˆã‚’ä½œæˆ\n\n// Setã§é‡è¤‡æ’é™¤\nconst uniqueUrls = new Set();\n\n// å„ã‚¢ã‚¤ãƒ†ãƒ ã‹ã‚‰ pageUrl ã¨ assetUrls ã‚’é›†ã‚ã‚‹\nfor (const item of items) {\n  const jsonData = item.json || {};\n\n  const pageUrlRaw = jsonData.pageUrl;\n  const assetUrlList = Array.isArray(jsonData.assetUrls) ? jsonData.assetUrls : [];\n\n  // ãƒšãƒ¼ã‚¸URLã‚’è¿½åŠ \n  if (typeof pageUrlRaw === 'string' && pageUrlRaw.length > 0) {\n    uniqueUrls.add(pageUrlRaw);\n  }\n\n  // ã‚¢ã‚»ãƒƒãƒˆURLç¾¤ã‚’è¿½åŠ \n  for (const assetUrlRaw of assetUrlList) {\n    if (typeof assetUrlRaw === 'string' && assetUrlRaw.length > 0) {\n      uniqueUrls.add(assetUrlRaw);\n    }\n  }\n}\n\n// Set â†’ n8n items ã«å¤‰æ›ï¼ˆé‡è¤‡æ’é™¤æ¸ˆã¿ï¼‰\nreturn Array.from(uniqueUrls).map((url) => ({\n  json: { targetUrl: url },\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        992,
        2752
      ],
      "id": "6e2d08d1-39a8-4c52-bcb5-7e780978d346",
      "name": "150 Merge Page and Assets to Unique Urls"
    },
    {
      "parameters": {
        "jsCode": "const out = [];\n\n// URLæ–‡å­—åˆ—ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹é–¢æ•° (ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚’å®Œå…¨ç¶­æŒ)\nfunction cleanUrlString(inputUrl) {\n  if (typeof inputUrl !== 'string') return inputUrl;\n\n  // HTMLã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã®é™¤å»\n  let normalizedUrl = inputUrl\n    .replace(/&quot;/g, '\\\"')\n    .replace(/\\\\\\\"/g, '\\\"')\n    .replace(/\\\\'/g, \"'\");\n\n  // å…ˆé ­ã¨æœ«å°¾ã®ä¸¡æ–¹ã‹ã‚‰ã‚¯ã‚©ãƒ¼ãƒˆã‚’é™¤å»\n  normalizedUrl = normalizedUrl.replace(/^[\\\"']+|[\\\"']+$/g, '');\n\n  return normalizedUrl.trim();\n}\n\n// -------------------------------------------------------------------\n// ã€è¨­å®šç®‡æ‰€ 1ã€‘é™¤å¤–å¯¾è±¡ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€è¦§ (ã‚ªãƒªã‚¸ãƒŠãƒ«ã¨å®Œå…¨ä¸€è‡´)\n// -------------------------------------------------------------------\nconst EXCLUDED_URL_PATTERNS = [\n  '/wp-json/',\n  '/admin-ajax.php',\n  '/xmlrpc.php',\n  '/feed',\n  'contact',\n  '/search',\n  '/page',\n  '/blog',\n  'ã€‚',\n  'beacon.min.js',\n];\n\n// -------------------------------------------------------------------\n// ã€è¨­å®šç®‡æ‰€ 2ã€‘ å®Œå…¨ä¸€è‡´ã§é™¤å¤–ã™ã‚‹ CDN ãƒ«ãƒ¼ãƒˆURL (ã‚ªãƒªã‚¸ãƒŠãƒ«ã¨å®Œå…¨ä¸€è‡´)\n// -------------------------------------------------------------------\nconst EXCLUDED_ROOT_URLS = [\n  'https://cdn-ileamdm.nitrocdn.com/',\n  'https://cdn-ileamdm.nitrocdn.com',\n];\n\n/**\n * UUIDã®æ­£è¦è¡¨ç¾ (8-4-4-4-12å½¢å¼)\n * ã€ä¿®æ­£æ¸ˆã€‘ã‚ªãƒªã‚¸ãƒŠãƒ«ã¨å®Œå…¨ã«ä¸€è‡´ã•ã›ã€åŠ£åŒ–ã‚’è§£æ¶ˆ\n */\nconst UUID_PATTERN = /[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i;\n\n// URLãŒé™¤å¤–å¯¾è±¡ã‹åˆ¤å®š (ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚’ç¶­æŒ)\nfunction isExcludedUrl(targetUrl) {\n  return EXCLUDED_URL_PATTERNS.some(pattern => targetUrl.includes(pattern));\n}\n\n// http/httpsä»¥å¤–ã¯ç„¡åŠ¹ (ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚’ç¶­æŒ)\nfunction isValidHttpUrl(targetUrl) {\n  if (typeof targetUrl !== 'string') return false;\n  return /^https?:\\/\\//i.test(targetUrl);\n}\n\n// -------------------------------------------------------------------\n// ã€è¿½åŠ æ©Ÿèƒ½ã€‘ã‚¢ã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«åˆ¤å®š (æ•‘æ¸ˆãƒ­ã‚¸ãƒƒã‚¯ç”¨)\n// -------------------------------------------------------------------\nfunction isAssetFile(url) {\n  const assetExtensions = /\\.(js|css|png|jpg|jpeg|gif|svg|webp|woff2?|ttf|otf|ico|bmp)$/i;\n  return assetExtensions.test(url);\n}\n\n// ==========================================\n// ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ«ãƒ¼ãƒ— (æ—§ã‚³ãƒ¼ãƒ‰ã®å …ç‰¢æ€§ã‚’æœ€å„ªå…ˆ)\n// ==========================================\nfor (const item of items) {\n  const rawUrl = item.json?.targetUrl;\n  if (typeof rawUrl !== 'string' || rawUrl.length === 0) continue;\n\n  const cleanedUrl = cleanUrlString(rawUrl);\n\n  // 1. å®Œå…¨ä¸€è‡´ã®ãƒ«ãƒ¼ãƒˆURLã‚’é™¤å¤– (ã‚ªãƒªã‚¸ãƒŠãƒ«é€šã‚Š)\n  if (EXCLUDED_ROOT_URLS.includes(cleanedUrl)) continue;\n\n  // 2. UUIDå½¢å¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é™¤å¤– (ã‚ªãƒªã‚¸ãƒŠãƒ«é€šã‚Š / 404å¯¾ç­–)\n  // ã“ã“ã§392ä»¶ã®ã‚´ãƒŸã‚’ç¢ºå®Ÿã«æŠ¹æ®ºã—ã¾ã™\n  if (UUID_PATTERN.test(cleanedUrl)) continue; \n\n  // 3. ã€è¿½åŠ ã€‘ã‚¢ã‚»ãƒƒãƒˆæ•‘æ¸ˆ (contactãŒå«ã¾ã‚Œã¦ã„ã¦ã‚‚ã€js/cssãªã‚‰ã“ã“ã§åˆæ ¼ã•ã›ã‚‹)\n  if (isAssetFile(cleanedUrl)) {\n    out.push({ json: { targetUrl: cleanedUrl } });\n    continue;\n  }\n\n  // 4. ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã«ã‚ˆã‚‹é™¤å¤– (ã‚ªãƒªã‚¸ãƒŠãƒ«é€šã‚Š / wp-json, feedç­‰)\n  if (isExcludedUrl(cleanedUrl)) continue;\n\n  // 5. http(s)ä»¥å¤–ã¯ã‚¹ã‚­ãƒƒãƒ— (ã‚ªãƒªã‚¸ãƒŠãƒ«é€šã‚Š)\n  if (!isValidHttpUrl(cleanedUrl)) continue;\n\n  out.push({ json: { targetUrl: cleanedUrl } });\n}\n\nreturn out;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1216,
        2752
      ],
      "id": "7a9054ee-df29-47e7-9443-bb926fa66958",
      "name": "155 Unwanted URL Ptterns Filter"
    },
    {
      "parameters": {
        "jsCode": "// items[*].json.url ã‚’è¦‹ã¦ json.urltype ã‚’ä»˜ä¸\n//\n// â‘  ã‚¢ã‚»ãƒƒãƒˆæ‹¡å¼µå­ (.css/.js/.jpg/.jpeg/.gif/.png/.webp/.avif/å„ç¨®ãƒ•ã‚©ãƒ³ãƒˆ) ãŒ URL æœ«å°¾ã«ã‚ã‚‹ â†’ \"asset\"\n// â‘¡ ã‚¢ã‚»ãƒƒãƒˆæ‹¡å¼µå­ãŒ URL æœ«å°¾ã«ç„¡ã„ã€ã‚‚ã—ãã¯ /(ã‚¹ãƒ©ãƒƒã‚·ãƒ¥) ã‚‚ã—ãã¯ .html / .htm â†’ \"main_document\"\n// â‘¢ ä¸Šè¨˜ä»¥å¤– \"exception\"\n\nconst ASSET_EXTENSIONS = [\n  'css',\n  'js', //ãƒ†ã‚¹ãƒˆæ™‚ã¯jsã‚„cssã ã‘ã«ã™ã‚‹ã¨å‰Šæ¸›ã—ã‚„ã™ã„\n  'jpg', 'jpeg', 'gif', 'png', 'webp',   'avif', 'svg', 'ico',\n  'woff', 'woff2', 'ttf', 'otf', 'eot',\n];\n\nreturn items.map(item => {\n  if (!item.json || typeof item.json.targetUrl !== 'string') {\n    return item;\n  }\n  //å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤ã—ã¦ã‚¯ãƒªãƒ¼ãƒ³ãªURLæ–‡å­—åˆ—ã«\n  const inputUrl = item.json.targetUrl.trim();\n\n  let urlPath = '/';\n\n  // ãƒ›ã‚¹ãƒˆã‚ˆã‚Šå¾Œã‚ï¼ˆãƒ‘ã‚¹éƒ¨åˆ†ï¼‰ã‚’å–ã‚Šå‡ºã™\n  try {\n    const parsedUrl = new URL(inputUrl);\n    urlPath = parsedUrl.pathname || '/';\n  } catch (error) {\n    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‹ãƒ›ã‚¹ãƒˆã‚’å‰Šã‚‹\n    const match = inputUrl.match(/^[a-zA-Z][a-zA-Z0-9+.-]*:\\/\\/[^/]+(\\/.*)?$/);\n    urlPath = (match && match[1]) ? match[1] : '/';\n  }\n\n\n  // ãƒ‘ã‚¹ã®æœ€å¾Œã®è¦ç´ ï¼ˆ/ ã ã‘ãªã‚‰ç©ºæ–‡å­—ï¼‰\n  const pathSegments = urlPath.split('/').filter(Boolean);\n  const lastPathSegment = pathSegments.length ? pathSegments[pathSegments.length - 1] : '';\n\n  // æ‹¡å¼µå­ã‚’å–å¾—ï¼ˆç„¡ã‘ã‚Œã°ç©ºæ–‡å­—ï¼‰\n  let fileExtension = '';\n  const dotIndex = lastPathSegment.lastIndexOf('.');\n  if (dotIndex !== -1 && dotIndex < lastPathSegment.length - 1) {\n    fileExtension = lastPathSegment.slice(dotIndex + 1).toLowerCase();\n  }\n\n  //URLã‚¿ã‚¤ãƒ—åˆ†é¡ã‚’é–‹å§‹\n  \n  let urlCategory;\n\n  // â‘  ã‚¢ã‚»ãƒƒãƒˆæ‹¡å¼µå­ãŒ URL æœ«å°¾ã«ã‚ã‚‹\n  if (ASSET_EXTENSIONS.includes(fileExtension)) {\n    urlCategory = 'asset';\n\n  // â‘¡ ã‚¢ã‚»ãƒƒãƒˆæ‹¡å¼µå­ãŒç„¡ã„ã€æœ«å°¾ãŒ /ã€ã¾ãŸã¯ .html / .htm\n  } else if (\n    fileExtension === '' ||             // ã‚¢ã‚»ãƒƒãƒˆæ‹¡å¼µå­ãªã—\n    urlPath.endsWith('/') ||            // URLæœ«å°¾ãŒã‚¹ãƒ©ãƒƒã‚·ãƒ¥\n    fileExtension === 'html' ||\n    fileExtension === 'htm'\n  ) {\n    urlCategory = 'main_document';\n\n  // â‘¢ ä¸Šè¨˜ä»¥å¤–ã¯ä¾‹å¤–\n  } else {\n    urlCategory = 'exception';\n  }\n\n  item.json.urltype = urlCategory;\n  return item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1440,
        2752
      ],
      "id": "140eb5a6-748d-4307-bd4b-7e4ee6a6eabb",
      "name": "160 Asset / MainDoc / Exception Classification"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2d8adb7d-a3d1-4344-bc18-3767ef6c8d18",
              "leftValue": "={{ $json.urltype }}",
              "rightValue": "exception",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1696,
        2752
      ],
      "id": "af98c20c-db63-4ec1-a5c1-b8b58f3e0f32",
      "name": "165 exception Filter"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// URLã‚¿ã‚¤ãƒ—ã”ã¨ã«é©ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸€è¦§\nconst mainDocumentUserAgentList = [\n  { label: 'ios_safari_17', ua: 'Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1' },\n  //{ label: 'android_chrome_pixel', ua: 'Mozilla/5.0 (Linux; Android 13; Pixel 7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Mobile Safari/537.36' },\n  //{ label: 'android_chrome_galaxy', ua: 'Mozilla/5.0 (Linux; Android 13; SM-G998B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Mobile Safari/537.36' },\n  //{ label: 'android_go', ua: 'Mozilla/5.0 (Linux; Android 12; Android Go) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.5993.60 Mobile Safari/537.36' },\n  //{ label: 'ios_safari_16', ua: 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1' },\n  //{ label: 'android_webview', ua: 'Mozilla/5.0 (Linux; Android 13; Pixel 6) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/118.0.0.0 Mobile Safari/537.36' },\n];\n\nconst assetUserAgentList = [\n  { label: 'ios_safari_17', ua: 'Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1' },\n  //{ label: 'android_chrome_pixel', ua: 'Mozilla/5.0 (Linux; Android 13; Pixel 7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Mobile Safari/537.36' },\n  //{ label: 'android_chrome_galaxy', ua: 'Mozilla/5.0 (Linux; Android 13; SM-G998B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Mobile Safari/537.36' },\n  //{ label: 'android_go', ua: 'Mozilla/5.0 (Linux; Android 12; Android Go) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.5993.60 Mobile Safari/537.36' },\n  //{ label: 'ios_safari_16', ua: 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1' },\n  //{ label: 'android_webview', ua: 'Mozilla/5.0 (Linux; Android 13; Pixel 6) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/118.0.0.0 Mobile Safari/537.36' },\n];\n\n// å‡ºåŠ›ç”¨é…åˆ—\nconst out = [];\n\nfor (const item of items) {\n  const urlData = item.json ?? item;\n  if (!urlData.targetUrl || !urlData.tokenCalculatedByN8n) continue;\n\n  const urlCategory = urlData.urltype;\n\n  // exception ã¯ç ´æ£„\n  if (urlCategory === 'exception') {\n    continue;\n  }\n\n  let selectedUserAgents;\n  if (urlCategory === 'asset') {\n    selectedUserAgents = assetUserAgentList;\n  } else if (urlCategory === 'main_document') {\n    selectedUserAgents = mainDocumentUserAgentList;\n  } else {\n    // æŒ‡å®šä»¥å¤–ã® urltype ã¯å‡ºåŠ›ã—ãªã„\n    continue;\n  }\n\n  for (const userAgent of selectedUserAgents) {\n    out.push({\n      json: {\n        ...urlData,\n        headers: { 'User-Agent': userAgent.ua },\n        userAgentLabel: userAgent.label,\n      },\n    });\n  }\n}\n\nreturn out;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2128,
        2768
      ],
      "id": "9b37b20d-2cc3-406b-9d82-229471b1bca5",
      "name": "175 Assign UserAgents By UrlType"
    },
    {
      "parameters": {
        "jsCode": "// å…¥åŠ›: [{ json: { targetUrl, tokenCalculatedByN8n, headers, userAgentLabel } }, ...]\nconst items = $input.all();\n\nreturn items.map((item, i) => ({\n  json: {\n    ...item.json,\n    httpRequestNumber: i + 1, // 1å§‹ã¾ã‚Š\n  },\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2640,
        2768
      ],
      "id": "0ff5f6e3-122d-40b8-a466-e0682d374903",
      "name": "185 Add Http Request Number"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// EO Request Engine ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ Serverless Proxy Fetcher ã¨ è¨€èª(Accept-Language)ã®ä¸€è¦§\n// ï¼ˆä¸»ã«ã‚¯ãƒ©ã‚¦ãƒ‰ç¨®åˆ¥ã®ã‚µãƒ¼ãƒãƒ¬ã‚¹ã‚µãƒ¼ãƒ“ã‚¹ã¨ã‚¨ãƒªã‚¢ï¼‰\nconst requestEngineList = [\n\n  { \n    type_area: 'AwsLambda_ap-northeast-1',\n    accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  },\n\n  { \n    type_area: 'AzureFunctions_japan-east',\n    accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  },\n  { \n    type_area: 'CloudflareWorker_global',\n    accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  },\n  { \n    type_area: 'GcpCloudFunctions_asia-northeast1',\n    accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  },\n  // Example\n  // { \n  //   type_area: 'DirectRequest',\n  //   accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  // },\n  // { \n  //   type_area: 'AwsLambda_ap-northeast-1',\n  //   accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  // },\n  // { \n  //   type_area: 'AzureFunctions_japan-east',\n  //   accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  // },\n  // { \n  //   type_area: 'CloudflareWorker_global',\n  //   accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  // },\n  // { \n  //   type_area: 'GcpCloudFunctions_asia-northeast1',\n  //   accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  // },\n\n  // { \n  //   type_area: 'AkamaiEdgeworker_global',\n  //   accept_language: 'ja,ja-JP;q=0.9,en-US;q=0.8,en;q=0.7',\n  // },\n  \n  // â€» accept_languageç„¡ã—ã®å ´åˆ\n  // { \n  //   type_area: 'CloudflareWorker_global' ,\n  //   accept_language: 'nothing',\n  // },  \n];\n\n// å‡ºåŠ›ç”¨é…åˆ—\nconst out = [];\n\nfor (const item of items) {\n  const baseData = item.json ?? item;\n\n  // targetUrl / tokenCalculatedByN8n ãŒç„¡ã„è¡Œã¯ã‚¹ã‚­ãƒƒãƒ—\n  if (!baseData.targetUrl || !baseData.tokenCalculatedByN8n) continue;\n\n  // 1ä»¶ã®å…¥åŠ›ã«å¯¾ã—ã€requestEngineList å…¨ã‚¨ãƒ³ã‚¸ãƒ³ã‚’å±•é–‹\n  for (const requestEngine of requestEngineList) {\n    // æ—¢å­˜ headersï¼ˆUser-Agent ç­‰ï¼‰ã‚’å£Šã•ãªã„ã‚ˆã†ã«ã‚³ãƒ”ãƒ¼\n    const headers = { ...(baseData.headers || {}) };\n\n    if (\n      requestEngine.accept_language &&\n      requestEngine.accept_language !== 'nothing'\n    ) {\n      // Accept-Language ã‚’ä»˜ä¸ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³\n      headers['Accept-Language'] = requestEngine.accept_language;\n    } else {\n      // â€œnothingâ€ ã®å ´åˆã¯ Accept-Language ãƒ˜ãƒƒãƒ€ã‚’ä»˜ã‘ãªã„ï¼ˆå­˜åœ¨ã—ã¦ã„ã‚Œã°å‰Šé™¤ï¼‰\n      delete headers['Accept-Language'];\n    }\n\n    out.push({\n      json: {\n        // å…ƒãƒ‡ãƒ¼ã‚¿å¼•ãç¶™ã\n        ...baseData,\n\n        // Request Engine æƒ…å ±\n        cloud_type_area: requestEngine.type_area,\n\n        // User-Agent ãªã©æ—¢å­˜ãƒ˜ãƒƒãƒ€ + Accept-Language ã‚’åæ˜ \n        headers,\n      },\n    });\n  }\n}\n\nreturn out;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2320,
        2768
      ],
      "id": "0e014e3c-304c-4f55-8705-b24f6dcf1bb7",
      "name": "180 RequestEngine Settings"
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -768,
        3232
      ],
      "id": "b2eedba5-6acb-4f2a-8377-e478fa96fbf3",
      "name": "220 Loop Over Request Target Urls",
      "alwaysOutputData": true,
      "notesInFlow": false
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3bb041ef-26df-488b-9908-7e6b4ea46b25",
                    "leftValue": "={{ $json.data.cloud_type_area }}",
                    "rightValue": "DirectRequest",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.cloud_type_area }}",
                    "rightValue": "AwsLambda_ap-northeast-1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "52c785e4-442b-4698-85c4-58a597b93600"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5b6b6497-ea80-41e3-8a11-7cf871ea2062",
                    "leftValue": "={{ $json.data.cloud_type_area }}",
                    "rightValue": "AzureFunctions_japan-east",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e2d8e0ee-e416-4b84-9532-1ea1f78ac3c5",
                    "leftValue": "={{ $json.data.cloud_type_area }}",
                    "rightValue": "CloudflareWorker_global",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "040783cf-d13f-477c-8c36-757efb935816",
                    "leftValue": "={{ $json.data.cloud_type_area }}",
                    "rightValue": "GcpCloudFunctions_asia-northeast1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -464,
        3392
      ],
      "id": "86be1903-1c77-4cdb-9452-13690bc806f4",
      "name": "225 Request Engine Switcher"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://iaeodentials.googleapis.com/v1/projects/-/serviceAccounts/<Oauth2_Invokerã‚µãƒ¼ãƒ“ã‚¹ã‚«ã‚¦ãƒ³ãƒˆeãƒ¡ãƒ¼ãƒ«>",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"audience\": \"https://eo-re-d01-cloudrun-ane1-4yharzvoqq-an.a.run.app\",\n  \"includeEmail\": true\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -272,
        4064
      ],
      "id": "16c67107-ba21-4e83-97c3-ca7942e3dba3",
      "name": "235 Get IDtoken From GCP Service Account Access Token",
      "alwaysOutputData": false,
      "credentials": {
        "googleApi": {
          "id": "iuOzBoOIfsCT41rU",
          "name": "Dummy GCP"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "769698a5-49d2-423c-bc69-86015cdb5a25",
              "name": "gcf.idToken",
              "value": "={{ $json.token }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -32,
        4064
      ],
      "id": "81410cad-cd67-46fd-af19-1a402bcfb502",
      "name": "240 IDtoken to json"
    },
    {
      "parameters": {
        "jsCode": "// ã™ã¹ã¦ã® input items ã‚’å–å¾—\nconst items = $input.all();\nconst out = [];\n\nfor (const item of items) {\n  const j = item.json || {};\n\n  // data ã‚’å‰Šé™¤ã—ãŸæ–°ã—ã„ JSON ã‚’ä½œã‚‹\n  const cleaned = {\n    headers: j.headers ?? {},\n    statusCode: j.statusCode ?? null,\n    statusMessage: j.statusMessage ?? null,\n  };\n\n  out.push({ json: cleaned });\n}\n\nreturn out;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        3344
      ],
      "id": "352cb76c-8b0d-4a07-862d-61d0258e27b4",
      "name": "285 JSON data REMOVER"
    },
    {
      "parameters": {
        "jsCode": "// Lambdaãƒãƒ¼ãƒ‰ã®å‡ºåŠ›: { json: { result: { ...æœ¬ä½“... } } }\n// Workerãƒãƒ¼ãƒ‰ã®å‡ºåŠ›:  { json: { ...æœ¬ä½“... } }\n//\n// ä¸¡æ–¹ã«å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ã€result ãŒã‚ã‚Œã°ä¸­èº«ã ã‘ã‚’ json ã«ç§»ã—æ›¿ãˆã‚‹ã€‚\n\nconst items = $input.all();\n\nfor (const item of items) {\n  const j = item.json;\n  if (\n    j &&\n    typeof j === 'object' &&\n    !Array.isArray(j) &&\n    j.result &&\n    typeof j.result === 'object' &&\n    !Array.isArray(j.result)\n  ) {\n    // resulté…ä¸‹ãŒãƒ•ãƒ©ãƒƒãƒˆEOãƒ­ã‚°æœ¬ä½“ãªã®ã§ã€ãã“ã«å·®ã—æ›¿ãˆã‚‹\n    item.json = j.result;\n  }\n}\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        3536
      ],
      "id": "9bf63728-a593-4781-843f-99cec337e9ef",
      "name": "295 JSON result REMOVER"
    },
    {
      "parameters": {
        "jsCode": "return $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        3856
      ],
      "id": "522f1f20-ddbb-42d7-ad6f-7201337ef17d",
      "name": "230 data Keeper for GCP"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n  // å…ƒã® headers ã‚’é€€é¿ã—ã¦ãŠã\n  const originalHeaders = item.json.headers;\n\n  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ body ãŒã‚ã‚Œã°ã€json ã®ãƒ«ãƒ¼ãƒˆã«å¼•ãä¸Šã’ (æ—¢å­˜å‡¦ç†)\n  if (item.json.body) {\n    item.json = item.json.body;\n  }\n\n  // é€€é¿ã—ã¦ãŠã„ãŸ headers ãŒã‚ã‚Œã°ã€ã‚­ãƒ¼åã« \"headers.\" ã‚’ä»˜ã‘ã¦è¿½åŠ  (æ–°è¦å‡¦ç†)\n  if (originalHeaders) {\n    Object.keys(originalHeaders).forEach(key => {\n      item.json[`headers.${key}`] = originalHeaders[key];\n    });\n  }\n\n  return item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        848,
        4160
      ],
      "id": "c3be235e-c187-4f86-bae5-02f2d7946ba8",
      "name": "305 GCP Arranger"
    },
    {
      "parameters": {
        "jsCode": "const delay = Math.floor(Math.random() * 3000) + 1000; // 1000ã€œ3999ms\nawait new Promise(r => setTimeout(r, delay));\nreturn [{ json: { ...$json, waitSeconds: delay / 1000 } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1792,
        4208
      ],
      "id": "e77f082a-742b-4a0d-bb8a-9e4dd5a81449",
      "name": "340 Random Sleep (ms)",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// å…¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—\nconst inputItems = $input.all();\n\n/**\n * ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ \"a.b.c\" å½¢å¼ã§ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã™ã‚‹å†å¸°é–¢æ•°\n */\nfunction flattenNestedObject(targetObject, parentKey = '', flattenedResult = {}) {\n  for (const [currentKey, currentValue] of Object.entries(targetObject)) {\n    const combinedKey = parentKey ? `${parentKey}.${currentKey}` : currentKey;\n\n    if (\n      currentValue !== null &&\n      typeof currentValue === 'object' &&\n      !Array.isArray(currentValue)\n    ) {\n      // å†å¸°å‡¦ç†ã§ã•ã‚‰ã«æ·±ã„éšå±¤ã‚’å±•é–‹\n      flattenNestedObject(currentValue, combinedKey, flattenedResult);\n    } else {\n      // å€¤ã‚’ã‚»ãƒƒãƒˆï¼ˆnull ã‚„ undefined ã¯ç©ºæ–‡å­—ã«å¤‰æ›ï¼‰\n      flattenedResult[combinedKey] = currentValue === undefined ? '' : currentValue;\n    }\n  }\n  return flattenedResult;\n}\n\nconst flattenedOutputItems = [];\n\nfor (const item of inputItems) {\n  const originalJson = item.json || {};\n  // item.json ã‚’ãƒ•ãƒ©ãƒƒãƒˆåŒ–\n  const flattenedJson = flattenNestedObject(originalJson);\n  flattenedOutputItems.push({ json: flattenedJson });\n}\n\n// ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚ŒãŸè¤‡æ•°ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿”ã™\nreturn flattenedOutputItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2032,
        3216
      ],
      "id": "ca594d0f-2893-451d-a123-13a08115b352",
      "name": "350 Json Flattener for Csv"
    },
    {
      "parameters": {
        "jsCode": "return $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1920,
        1920
      ],
      "id": "38bd4c7e-b1eb-4287-9ee5-e39bad0a255c",
      "name": "115 Step.1 Separate Starter Dummy"
    },
    {
      "parameters": {
        "jsCode": "// ã™ã¹ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ã«å¯¾ã—ã¦ãƒ«ãƒ¼ãƒ—å‡¦ç†\nreturn items.map(item => {\n  \n  // 1. ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨Ageã‚’å–å¾—\n  // â€»Node 350ã®å¾Œãªã®ã§ã€ãƒ‰ãƒƒãƒˆåŒºåˆ‡ã‚Šã®ã‚­ãƒ¼åã§æŒ‡å®šã—ã¾ã™\n  const status = (item.json['headers.response-headers.cf-cache-status'] || '').toUpperCase();\n  const age = parseInt(item.json['headers.response-headers.age'] || '0', 10);\n\n  let message = \"\";\n\n  // 2. åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆçŸ­ã„è‹±èªãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰\n  if (status === 'MISS' || status === 'EXPIRED') {\n    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ï¼ˆæ¶ˆå¤±ï¼‰\n    message = \"âš ï¸ EVICTED: Cache Lost\";\n    \n  } else if (status === 'HIT' && age < 60) {\n    // ç›´å‰ã«ç”Ÿæˆã•ã‚ŒãŸï¼ˆã‚®ãƒªã‚®ãƒªã‚»ãƒ¼ãƒ•ï¼‰\n    message = \"âš ï¸ FRESH: Just Created\";\n    \n  } else if (status === 'DYNAMIC' || status === 'BYPASS') {\n    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾è±¡å¤–ï¼ˆæ„å›³çš„ãªè¨­å®šï¼‰\n    message = \"â„¹ï¸ IGNORE: Dynamic/Bypass\";\n    \n  } else if (status === 'HIT') {\n    // æ­£å¸¸ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥\n    message = \"âœ… SAFE: Cache Active\";\n    \n  } else {\n    // Cloudflareä»¥å¤–ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚„ä¸æ˜ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹\n    message = \"-\";\n  }\n\n  // 3. æ–°ã—ã„ã‚«ãƒ©ãƒ ã€Œeo.re.eviction-alertã€ã¨ã—ã¦è¿½åŠ \n  item.json['eo.re.eviction-alert'] = message;\n\n  return item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2736,
        3216
      ],
      "id": "cdb8bc50-90a7-4ced-8cb6-6ec4a17b17f9",
      "name": "355 Eviction Detector"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -640,
        1712
      ],
      "id": "a57818bd-ad23-4707-9321-3d43276d91b9",
      "name": "010 Step.0 Starter by XML sitemap"
    },
    {
      "parameters": {
        "url": "https://dns.google/resolve",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "name",
              "value": "={{ \"_eo-auth.\" + $json.Website.match(/^https?:\\/\\/([^\\/?#]+)/i)[1] }}"
            },
            {
              "name": "type",
              "value": "TXT"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -464,
        1712
      ],
      "id": "bf72dfe7-a7dd-4270-a91d-3b6a987ad79d",
      "name": "015 DNS Fetch TXT"
    },
    {
      "parameters": {
        "jsCode": "// 15 DNS Auth Node\nconst items = $input.all();\nconst DNSTXT_TOKEN = \"eo-authorized-sample\"; \n\nfor (const item of items) {\n  // Answeré…åˆ—ã®ä¸­ã«ã€DNSTXT_TOKENã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n  const records = item.json.Answer || [];\n  const isOk = records.some(r => r.data && r.data.includes(DNSTXT_TOKEN));\n\n  if (!isOk) {\n    throw new Error(\"ã€DNSèªè¨¼æ‹’å¦ã€‘æ­£å½“ãªæ‰€æœ‰æ¨©ãŒç¢ºèªã§ãã¾ã›ã‚“ã€‚å®Ÿè¡Œã‚’åœæ­¢ã—ã¾ã™ã€‚\");\n  }\n}\n\n// èªè¨¼æˆåŠŸãªã‚‰ã€ã€ŒStart by XML sitemapã€ãƒãƒ¼ãƒ‰ã®Websiteæƒ…å ±ã‚’ã€Œå¾©å…ƒã€ã—ã¦æ¬¡ã«æ¸¡ã™\nreturn [ { json: $node[\"010 Step.0 Starter by XML sitemap\"].json } ];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -288,
        1712
      ],
      "id": "39a953cd-8d2b-4017-b835-c055f0fd8e59",
      "name": "020 DNS Auth"
    },
    {
      "parameters": {
        "url": "={{ $json.Website }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -64,
        1712
      ],
      "id": "948054db-1e80-47ab-8bd1-10a60b242baa",
      "name": "040 Direct HTTP Req to get Tier2 XML sitemap URLs"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.xml",
      "typeVersion": 1,
      "position": [
        128,
        1712
      ],
      "id": "7fc98c0e-f744-4149-8c7d-835c7abf0fa3",
      "name": "045 XML to JSON"
    },
    {
      "parameters": {
        "jsCode": "const sitemapIndex = items[0].json.sitemapindex;\n\n// å­˜åœ¨ãƒã‚§ãƒƒã‚¯\nif (!sitemapIndex || !Array.isArray(sitemapIndex.sitemap)) {\n  throw new Error('sitemapindex.sitemap ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n}\n\n// sitemapé…åˆ—ã‹ã‚‰ã€loc ã‚’ï¼‘ä»¶ãšã¤urlã«å¤‰æ›ã€‚ä»–é …ç›®ã‚’æ’é™¤\nconst result = sitemapIndex.sitemap.map((entry) => {\n  return {\n    url: entry.loc,\n  };\n});\n\nreturn result;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        352,
        1712
      ],
      "id": "b914b4e6-86ee-48aa-b598-81b4339b335e",
      "name": "050 JSON to urls by loc"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        592,
        1712
      ],
      "id": "8e02c057-5f10-449c-8520-e599afc8d83d",
      "name": "055 Loop Over Tier2 locs"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true,
              "responseFormat": "text"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        768,
        1792
      ],
      "id": "a0cd6d09-4728-41a5-91c2-3b2497042dda",
      "name": "060 Direct HTTP Req to Tier2 locs"
    },
    {
      "parameters": {
        "jsCode": "const delay = Math.floor(Math.random() * 3000) + 1000; // 1000ã€œ3999ms\nawait new Promise(r => setTimeout(r, delay));\nreturn [{ json: { ...$json, waitSeconds: delay / 1000 } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        928,
        1856
      ],
      "id": "0e051006-3342-499f-9e06-52638e32401c",
      "name": "065 Random Sleep (ms)",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.xml",
      "typeVersion": 1,
      "position": [
        1120,
        1696
      ],
      "id": "8a366b05-9d0c-4c57-b06d-0b87b7d256e4",
      "name": "070 XML to JSON"
    },
    {
      "parameters": {
        "jsCode": "const out = [];\n\nfor (const item of items) {\n  const urlset = item.urlset || item.json?.urlset;\n  if (!urlset || !urlset.url) continue;\n\n  const urls = Array.isArray(urlset.url) ? urlset.url : [urlset.url];\n\n  for (const u of urls) {\n    out.push({\n      loc: Array.isArray(u.loc) ? u.loc[0] : u.loc\n    });\n  }\n}\n\nreturn out;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        1696
      ],
      "id": "fb55bddd-5ca2-457e-b48c-5c6dba94303d",
      "name": "075 Clean Page Urls with JSON"
    },
    {
      "parameters": {
        "jsCode": "// n8nã®å†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒã‚¹ã‚¯ã•ã‚Œã‚‹å‰ã®å€¤ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ã¾ã™\nconst items = $input.all();\n\n// å‰ã®ãƒãƒ¼ãƒ‰(HTTP Request)ã®å®Ÿè¡Œè¨­å®šã‹ã‚‰ã€CredentialçµŒç”±ã§ä»˜ä¸ã•ã‚ŒãŸå€¤ã‚’å–ã‚Šå‡ºã™\n// æ³¨æ„: Self-hostedç‰ˆã®ç’°å¢ƒã‚„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã‚Šã€ç›´æ¥å‚ç…§ã‚’åˆ¶é™ã—ã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™\nconst secretHeader = $node[\"025 Credential Fetch Request\"].parameter(\"headerParameters\");\n\n// æŠ½å‡ºå‡¦ç†\nreturn items.map(item => {\n  return {\n    json: {\n      ...item.json,\n\n      // Credentialã§è¨­å®šã—ãŸã€Œx-eo-request-secretã€ã¨ã„ã†ã‚­ãƒ¼ã‚’æ¢ã—ã¦æŠ½å‡º\n      // å–å¾—ã§ããªã„å ´åˆã¯ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ç©ºæ–‡å­—ã‚’è¿”ã—ã¾ã™\n\n      extracted_secret: secretHeader?.parameters?.find(p => p.headers === 'x-eo-request-secret')?.value || \"\"\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -288,
        1472
      ],
      "id": "8c22edfe-1a39-49ca-8701-760badf5b515",
      "name": "30 Response Secret Catcher"
    },
    {
      "parameters": {
        "url": "https://httpbin.org/get",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -560,
        1472
      ],
      "id": "80f18e3a-153d-4e65-89e5-a20dd89e19bb",
      "name": "025 Credential Fetch Request",
      "credentials": {
        "httpHeaderAuth": {
          "id": "JzB9PZ51pxKq63hX",
          "name": "EO_RE_Func_japaneast_AppKey"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 30 Secret Injection (ãƒ­ã‚°éœ²å‡ºå¯¾ç­–ç‰ˆ)\nconst items = $input.all();\n\nreturn items.map(item => {\n  return {\n    json: {\n      ...item.json,\n      // â˜…é‡è¦ï¼šã“ã“ã‚’ã€Œå¼ï¼ˆExpressionï¼‰ã€ã¨ã—ã¦è¨˜è¿°ã—ã¾ã™\n      // n8nã®GUIä¸Šã§ã€ã“ã®éƒ¨åˆ†ã‚’ä»¥ä¸‹ã® Expression ã«å·®ã—æ›¿ãˆã¦ãã ã•ã„\n      // {{$getCredentials('headerAuth', 'CacheWarmer_Secret').value}}\n      \n      // æ³¨æ„ï¼šCodeãƒãƒ¼ãƒ‰å†…ã§æ–‡å­—åˆ—ã¨ã—ã¦æ›¸ãã¨å‹•ãã¾ã›ã‚“ã€‚\n      // ãƒãƒ¼ãƒ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å…¥åŠ›æ¬„ã€ã¾ãŸã¯å¾Œç¶šã®170ç•ªãƒãƒ¼ãƒ‰ã§ç›´æ¥å‘¼ã³å‡ºã™ã®ãŒãƒ™ã‚¹ãƒˆã§ã™ã€‚\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -80,
        1488
      ],
      "id": "5fb61db6-5f34-41f7-8ca9-0da71c775674",
      "name": "30 Secret Injection"
    },
    {
      "parameters": {
        "content": "# èª²é¡Œ1\nhttps://www.youtube.com/watch?v=QAUOBAJkTkA \n\nã‚’å‚è€ƒã« n8nã®Credentialsã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ‰±ãˆã‚‹ã¨.envã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’è¨˜è¼‰ã™ã‚‹å¿…è¦ãŒãªããªã‚Šã€SaaSç‰ˆn8nã‚‚å«ã‚ã¦ä½¿ã„ã‚„ã™ããªã‚‹ã€‚ãƒãƒ¼ãƒ‰ã‚’ä½¿ã†ã¨å¹³æ–‡ã§INPUTã‚„OUTPUTã®ä¸­ã‚’é§†ã‘å·¡ã‚Šã€ãƒ­ã‚°ã«æ®‹ã‚‹ãŸã‚åˆ©ç”¨ä¸å¯ã€‚",
        "height": 304,
        "width": 768,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -656,
        1312
      ],
      "typeVersion": 1,
      "id": "286c9e9a-49e0-4093-9ad8-f49c338ca470",
      "name": "Sticky Note37"
    },
    {
      "parameters": {
        "content": "# èª²é¡Œ5\n\n## èªè¨¼ã®æµã‚Œ\n\nâ‘ DNSã®TXTãƒ¬ã‚³ãƒ¼ãƒ‰èªè¨¼\n\nâ‘¡n8nã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ\n\nâ‘¢ã‚¯ãƒ©ã‚¦ãƒ‰åŸºç›¤èªè¨¼ï¼ˆn8nã‹ã‚‰å„ç¨®ã‚µãƒ¼ãƒãƒ¬ã‚¹ã¸ã®æ¥ç¶šï¼‰\n\nâ‘£ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³å†…éƒ¨ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã€n8nè£½ãƒˆãƒ¼ã‚¯ãƒ³ã¨ç…§åˆ\n\n## è¦æ”¹å–„ç®‡æ‰€\n\nãƒˆãƒ¼ã‚¯ãƒ³ç”ŸæˆãŒ<ã‚¿ãƒ¼ã‚²ãƒƒãƒˆURL><ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ>ã®sha256åŠ å·¥ã§ã‚ã‚‹ãŸã‚ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ€§ã®å‘ä¸ŠãŒå¿…è¦",
        "height": 528,
        "width": 528,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        512,
        4432
      ],
      "typeVersion": 1,
      "id": "10ac53bb-66b7-446b-9200-0a5b7cddde2d",
      "name": "Sticky Note45"
    },
    {
      "parameters": {
        "content": "# Step.3\n\nData Analyzer\n\n400~",
        "height": 1472,
        "width": 150,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1344,
        5184
      ],
      "typeVersion": 1,
      "id": "2e4bf855-a461-44de-a931-7f91a4ba4719",
      "name": "Sticky Note48"
    },
    {
      "parameters": {
        "jsCode": "return $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3200,
        5040
      ],
      "id": "96948e39-2025-4a91-8cd6-5265fa4c3c56",
      "name": "415 Step.3 Separate Starter Dummy"
    },
    {
      "parameters": {
        "options": {
          "fileName": "=RequestResults_{{ $now.setZone('Asia/Tokyo').toFormat('yyyy-LL-dd_HH:mm') + '.csv' }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -928,
        5360
      ],
      "id": "8f046a1a-ac9b-496d-b739-7badbb2eb620",
      "name": "420 JSON to WarmupHistoryCSV"
    },
    {
      "parameters": {
        "url": "={{ $json.data.targetUrl }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "={{ $json.data.headers[\"User-Agent\"] }}"
            },
            {
              "name": "Accept-Language",
              "value": "={{ $json.data.headers[\"Accept-Language\"] }}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {
              "maxRedirects": 5
            }
          },
          "response": {
            "response": {
              "fullResponse": true,
              "neverError": true,
              "responseFormat": "text"
            }
          },
          "timeout": 180000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        592,
        3344
      ],
      "id": "8c609b92-71a6-4003-b309-242b8e2c4f3b",
      "name": "280DirectRequest"
    },
    {
      "parameters": {
        "url": "<CF Workersãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³URL>",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpCustomAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "targetUrl",
              "value": "={{ $json.data.targetUrl }}"
            },
            {
              "name": "tokenCalculatedByN8n",
              "value": "={{ $json.data.tokenCalculatedByN8n }}"
            },
            {
              "name": "httpRequestNumber",
              "value": "={{ $json.data.httpRequestNumber }}"
            },
            {
              "name": "httpRequestUUID",
              "value": "={{ $json.data.httpRequestUUID }}"
            },
            {
              "name": "httpRequestRoundID",
              "value": "={{ $json.httpRequestRoundID }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "={{ $json.data.headers[\"User-Agent\"] }}"
            },
            {
              "name": "Accept-Language",
              "value": "={{ $json.data.headers[\"Accept-Language\"] }}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {
              "maxRedirects": 5
            }
          },
          "response": {
            "response": {
              "neverError": true
            }
          },
          "timeout": 180000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        592,
        3952
      ],
      "id": "f6d6fa0c-06ad-4a77-8e4f-7bf22dad2488",
      "name": "280CF-global RequestEngine ZeroTrust",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "httpCustomAuth": {
          "id": "PjSzJTmlLNGjN3ow",
          "name": "Dummy CFWorker"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "<GCP CloudRunãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚µãƒ¼ãƒ“ã‚¹URL>/<ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ‘ã‚¹>",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "={{ $json.data.headers[\"User-Agent\"] }}"
            },
            {
              "name": "Accept-Language",
              "value": "={{ $json.data.headers[\"Accept-Language\"] }}"
            },
            {
              "name": "Authorization",
              "value": "={{ 'Bearer ' + $json.gcf.idToken }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"targetUrl\": \"{{ $json.data.targetUrl }}\",\n  \"tokenCalculatedByN8n\": \"{{ $json.data.tokenCalculatedByN8n }}\",\n  \"headers\": \"{{ $json.data.headers }}\",\n  \"httpRequestNumber\": \"{{ $json.data.httpRequestNumber }}\",\n  \"httpRequestUUID\": \"{{ $json.data.httpRequestUUID }}\",\n  \"httpRequestRoundID\": \"{{ $json.data.httpRequestRoundID }}\",\n  \"urltype\": \"{{ $json.data.urltype }}\"\n}",
        "options": {
          "redirect": {
            "redirect": {
              "maxRedirects": 5
            }
          },
          "response": {
            "response": {
              "fullResponse": true
            }
          },
          "timeout": 180000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        592,
        4160
      ],
      "id": "e624eb6b-fc0e-4ac2-84ee-a317f132fadd",
      "name": "280GCP-asia-northeast1 RequestEngine Oauth2 Bearer"
    },
    {
      "parameters": {
        "function": "=eo-re-d01-lambda-apne1",
        "payload": "={{ $json.data }}"
      },
      "type": "n8n-nodes-base.awsLambda",
      "typeVersion": 1,
      "position": [
        592,
        3536
      ],
      "id": "183b5be4-2009-4323-a94d-a31b81fb757b",
      "name": "280AWS-apne1 RequestEngine AccessKey",
      "credentials": {
        "aws": {
          "id": "Wc9FW6idtZk9tShE",
          "name": "AWS (IAM) account Dummy"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "<Az Functionsãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURL>",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "={{ $json.data.headers[\"User-Agent\"] }}"
            },
            {
              "name": "Accept-Language",
              "value": "={{ $json.data.headers[\"Accept-Language\"] }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"data\": {\n    \"targetUrl\": \"{{ $json.data.targetUrl }}\",\n    \"tokenCalculatedByN8n\": \"{{ $json.data.tokenCalculatedByN8n }}\",\n    \"headers\": {\n      \"User-Agent\": \"{{ $json.data.headers['User-Agent'] }}\",\n      \"Accept-Language\": \"{{ $json.data.headers['Accept-Language'] }}\"\n    },\n    \"httpRequestNumber\": {{ $json.data.httpRequestNumber }},\n    \"httpRequestUUID\": \"{{ $json.data.httpRequestUUID }}\",\n    \"httpRequestRoundID\": {{ $json.data.httpRequestRoundID }},\n    \"urltype\": \"{{ $json.data.urltype }}\"\n  }\n}",
        "options": {
          "redirect": {
            "redirect": {
              "maxRedirects": 5
            }
          },
          "response": {
            "response": {
              "fullResponse": true,
              "neverError": true
            }
          },
          "timeout": 180000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        592,
        3744
      ],
      "id": "2df2bc05-3c11-4802-b722-fadec4cbbb3e",
      "name": "280AZ-japan-east RequestEngine KeyVault",
      "credentials": {
        "httpHeaderAuth": {
          "id": "4oorBtBP5SuAimco",
          "name": "Azure Dummy Hedaer Auth"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 230 JSON data REMOVER ã® OUTPUT ã‚’å‰æ\n// [\n//   {\n//     \"headers\": { ... },\n//     \"statusCode\": 200,\n//     \"statusMessage\": \"OK\"\n//   }\n// ]\n\nconst items = $input.all();\n\nreturn items.map(item => {\n  const j = item.json || {};\n  const h = j.headers || {};\n\n  // statusCode ã¨ statusMessage ã‚’ \"200 OK\" ã®ã‚ˆã†ãªå½¢ã«çµåˆ\n  const statusCode = j.statusCode;\n  const statusMessage = j.statusMessage;\n  let combinedStatus = '';\n\n  if (statusCode !== undefined && statusCode !== null) {\n    combinedStatus = String(statusCode);\n  }\n  if (statusMessage) {\n    combinedStatus = combinedStatus\n      ? `${combinedStatus} ${statusMessage}`\n      : String(statusMessage);\n  }\n\n  return {\n    json: {\n      // â–  headers.* â†’ headers.response-headers.*\n      'headers.response-headers.server': h.server ?? '',\n      'headers.response-headers.date': h.date ?? '',\n      'headers.response-headers.content-type': h['content-type'] ?? '',\n      'headers.response-headers.transfer-encoding': h['transfer-encoding'] ?? '',\n      'headers.response-headers.connection': h.connection ?? '',\n      'headers.response-headers.vary': h.vary ?? '',\n      'headers.response-headers.link': h.link ?? '',\n\n      // â–  statusCode + statusMessage â†’ headers.general.status-code\n      'headers.general.status-code': combinedStatus,\n    },\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        3344
      ],
      "id": "0d1d7f5b-bead-474e-a30b-6642e1c8ab16",
      "name": "290 DirectRequest Arranger"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n  // å…ƒã® headers ã‚’é€€é¿ã—ã¦ãŠã\n  const originalHeaders = item.json.headers;\n\n  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ body ãŒã‚ã‚Œã°ã€json ã®ãƒ«ãƒ¼ãƒˆã«å¼•ãä¸Šã’ (æ—¢å­˜å‡¦ç†)\n  if (item.json.body) {\n    item.json = item.json.body;\n  }\n\n  // é€€é¿ã—ã¦ãŠã„ãŸ headers ãŒã‚ã‚Œã°ã€ã‚­ãƒ¼åã« \"headers.\" ã‚’ä»˜ã‘ã¦è¿½åŠ  (æ–°è¦å‡¦ç†)\n  if (originalHeaders) {\n    Object.keys(originalHeaders).forEach(key => {\n      item.json[`headers.${key}`] = originalHeaders[key];\n    });\n  }\n\n  return item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        832,
        3744
      ],
      "id": "d0b2e632-ee8e-402d-8f07-53d201c95c26",
      "name": "300 AZ Arranger"
    },
    {
      "parameters": {
        "jsCode": "// â–¼ Step.1 (HTMLè§£æ) ã‹ã‚‰å§‹ã‚ãŸã„URLãƒªã‚¹ãƒˆã‚’ã“ã®ä¸­ã«ã€URLã‚’ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå›²ã¿ã€ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¨˜è¿°\nconst targetPages = [\n  \"https://sample.com/\",\n  //\"https://sample.com/services/\",\n];\n\n// -------------------------------------------------------\n// Node 115 ä»¥é™ãŒæœŸå¾…ã™ã‚‹ã€Œlocã€ã‚­ãƒ¼ã‚’æŒã¤JSONå½¢å¼ã«å¤‰æ›ã—ã¦å‡ºåŠ›\n// -------------------------------------------------------\nreturn targetPages.map(url => ({\n  json: {\n    \"loc\":\"https://sample.com/voiceflow/voiceflow-welcome-summary/\"\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1504,
        1888
      ],
      "id": "73e12f59-95d2-4e1e-88f9-c492e38f6693",
      "name": "110 Step.1 Starter SimpleUrlList"
    },
    {
      "parameters": {
        "jsCode": "// Run Once for All Items ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ\nconst items = $input.all();\n\nreturn items.map(item => ({\n  json: {\n    data: item.json,  // å…ƒã®å†…å®¹ã‚’ data é…ä¸‹ã«\n  },\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3024,
        2768
      ],
      "id": "518c189b-363a-439b-9396-02766c5ccb41",
      "name": "195 Wrap Json In Data"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        320,
        4064
      ],
      "id": "15bab6a8-8fde-4faa-b45e-db651da9340a",
      "name": "245 data and GCP IDtoken Merger"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nreturn items.map((item) => {\n  let uuid;\n  try {\n    // æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®crypto.randomUUID()ã‚’è©¦ã™\n    uuid = crypto.randomUUID();\n  } catch (e) {\n    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: æ‰‹å‹•ç”Ÿæˆ\n    uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n      const r = Math.random() * 16 | 0;\n      const v = c === 'x' ? r : (r & 0x3 | 0x8);\n      return v.toString(16);\n    });\n  }\n  \n  return {\n    json: {\n      ...item.json,\n      httpRequestUUID: uuid,\n    },\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2848,
        2768
      ],
      "id": "191ef2f0-19d6-4e46-bc6f-b27aac131686",
      "name": "190 Add Http Request UUID"
    },
    {
      "parameters": {
        "jsCode": "return $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3232,
        2768
      ],
      "id": "4d49003f-3001-4ba9-94f5-2c353c8f9316",
      "name": "210 Step.2 Separate Starter Dummy"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst roundId = Math.floor(Date.now() / 1000); // ãƒãƒ¼ãƒ‰å®Ÿè¡Œæ™‚ç‚¹ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—\n\nreturn items.map((item) => ({\n  json: {\n    data: {\n      ...item.json.data,\n      httpRequestRoundID: roundId, // å…¨ã‚¢ã‚¤ãƒ†ãƒ åŒã˜å€¤ã‚’è¨­å®š\n    },\n  },\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1072,
        3232
      ],
      "id": "f82907a2-77c6-48be-bf44-08712484df0e",
      "name": "215 Add httpRequestRoundID"
    },
    {
      "parameters": {
        "type": "SHA256",
        "value": "={{ $json.targetUrl }}{{ $env.N8N_EO_REQUEST_SECRET }}",
        "dataPropertyName": "tokenCalculatedByN8n"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        1936,
        2768
      ],
      "id": "86914151-6e20-4704-817e-4245aefe934c",
      "name": "170 n8n RequestSecret Token Generator"
    }
  ],
  "pinData": {
    "010 Step.0 Starter by XML sitemap": [
      {
        "json": {
          "Website": "https://sample.com/wp-sitemap.xml"
        }
      }
    ]
  },
  "connections": {
    "120 Loop Over All Web Page Urls": {
      "main": [
        [
          {
            "node": "135 Merge Assets to URLs",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "125-1 HTTP Req to Get All TargetUrls through Playwright Container",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "125-1 HTTP Req to Get All TargetUrls through Playwright Container": {
      "main": [
        [
          {
            "node": "130 Random Sleep (ms)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "130 Random Sleep (ms)": {
      "main": [
        [
          {
            "node": "120 Loop Over All Web Page Urls",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "135 Merge Assets to URLs": {
      "main": [
        [
          {
            "node": "140 Extract Warmup Page Assets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "140 Extract Warmup Page Assets": {
      "main": [
        [
          {
            "node": "145 Query Param and Anchor Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "145 Query Param and Anchor Filter": {
      "main": [
        [
          {
            "node": "150 Merge Page and Assets to Unique Urls",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "150 Merge Page and Assets to Unique Urls": {
      "main": [
        [
          {
            "node": "155 Unwanted URL Ptterns Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "155 Unwanted URL Ptterns Filter": {
      "main": [
        [
          {
            "node": "160 Asset / MainDoc / Exception Classification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "160 Asset / MainDoc / Exception Classification": {
      "main": [
        [
          {
            "node": "165 exception Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "165 exception Filter": {
      "main": [
        [],
        [
          {
            "node": "170 n8n RequestSecret Token Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "175 Assign UserAgents By UrlType": {
      "main": [
        [
          {
            "node": "180 RequestEngine Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "185 Add Http Request Number": {
      "main": [
        [
          {
            "node": "190 Add Http Request UUID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "180 RequestEngine Settings": {
      "main": [
        [
          {
            "node": "185 Add Http Request Number",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "220 Loop Over Request Target Urls": {
      "main": [
        [
          {
            "node": "350 Json Flattener for Csv",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "225 Request Engine Switcher",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "225 Request Engine Switcher": {
      "main": [
        [
          {
            "node": "280DirectRequest",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "280AWS-apne1 RequestEngine AccessKey",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "280AZ-japan-east RequestEngine KeyVault",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "280CF-global RequestEngine ZeroTrust",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "235 Get IDtoken From GCP Service Account Access Token",
            "type": "main",
            "index": 0
          },
          {
            "node": "230 data Keeper for GCP",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "235 Get IDtoken From GCP Service Account Access Token": {
      "main": [
        [
          {
            "node": "240 IDtoken to json",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "240 IDtoken to json": {
      "main": [
        [
          {
            "node": "245 data and GCP IDtoken Merger",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "285 JSON data REMOVER": {
      "main": [
        [
          {
            "node": "290 DirectRequest Arranger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "295 JSON result REMOVER": {
      "main": [
        [
          {
            "node": "340 Random Sleep (ms)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "230 data Keeper for GCP": {
      "main": [
        [
          {
            "node": "245 data and GCP IDtoken Merger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "305 GCP Arranger": {
      "main": [
        [
          {
            "node": "340 Random Sleep (ms)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "340 Random Sleep (ms)": {
      "main": [
        [
          {
            "node": "220 Loop Over Request Target Urls",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "350 Json Flattener for Csv": {
      "main": [
        [
          {
            "node": "355 Eviction Detector",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "115 Step.1 Separate Starter Dummy": {
      "main": [
        [
          {
            "node": "135 Merge Assets to URLs",
            "type": "main",
            "index": 0
          },
          {
            "node": "120 Loop Over All Web Page Urls",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "355 Eviction Detector": {
      "main": [
        [
          {
            "node": "415 Step.3 Separate Starter Dummy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "010 Step.0 Starter by XML sitemap": {
      "main": [
        [
          {
            "node": "015 DNS Fetch TXT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "015 DNS Fetch TXT": {
      "main": [
        [
          {
            "node": "020 DNS Auth",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "020 DNS Auth": {
      "main": [
        [
          {
            "node": "040 Direct HTTP Req to get Tier2 XML sitemap URLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "040 Direct HTTP Req to get Tier2 XML sitemap URLs": {
      "main": [
        [
          {
            "node": "045 XML to JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "045 XML to JSON": {
      "main": [
        [
          {
            "node": "050 JSON to urls by loc",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "050 JSON to urls by loc": {
      "main": [
        [
          {
            "node": "055 Loop Over Tier2 locs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "055 Loop Over Tier2 locs": {
      "main": [
        [
          {
            "node": "070 XML to JSON",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "060 Direct HTTP Req to Tier2 locs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "060 Direct HTTP Req to Tier2 locs": {
      "main": [
        [
          {
            "node": "065 Random Sleep (ms)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "065 Random Sleep (ms)": {
      "main": [
        [
          {
            "node": "055 Loop Over Tier2 locs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "070 XML to JSON": {
      "main": [
        [
          {
            "node": "075 Clean Page Urls with JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "075 Clean Page Urls with JSON": {
      "main": [
        [
          {
            "node": "115 Step.1 Separate Starter Dummy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "025 Credential Fetch Request": {
      "main": [
        [
          {
            "node": "30 Response Secret Catcher",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "415 Step.3 Separate Starter Dummy": {
      "main": [
        [
          {
            "node": "420 JSON to WarmupHistoryCSV",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "280DirectRequest": {
      "main": [
        [
          {
            "node": "285 JSON data REMOVER",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "280CF-global RequestEngine ZeroTrust": {
      "main": [
        [
          {
            "node": "340 Random Sleep (ms)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "280GCP-asia-northeast1 RequestEngine Oauth2 Bearer": {
      "main": [
        [
          {
            "node": "305 GCP Arranger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "280AWS-apne1 RequestEngine AccessKey": {
      "main": [
        [
          {
            "node": "295 JSON result REMOVER",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "280AZ-japan-east RequestEngine KeyVault": {
      "main": [
        [
          {
            "node": "300 AZ Arranger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "290 DirectRequest Arranger": {
      "main": [
        [
          {
            "node": "340 Random Sleep (ms)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "300 AZ Arranger": {
      "main": [
        [
          {
            "node": "340 Random Sleep (ms)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "195 Wrap Json In Data": {
      "main": [
        [
          {
            "node": "210 Step.2 Separate Starter Dummy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "245 data and GCP IDtoken Merger": {
      "main": [
        [
          {
            "node": "280GCP-asia-northeast1 RequestEngine Oauth2 Bearer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "190 Add Http Request UUID": {
      "main": [
        [
          {
            "node": "195 Wrap Json In Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "210 Step.2 Separate Starter Dummy": {
      "main": [
        [
          {
            "node": "215 Add httpRequestRoundID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "215 Add httpRequestRoundID": {
      "main": [
        [
          {
            "node": "220 Loop Over Request Target Urls",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "170 n8n RequestSecret Token Generator": {
      "main": [
        [
          {
            "node": "175 Assign UserAgents By UrlType",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "110 Step.1 Starter SimpleUrlList": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "7d4cdc43-8203-483e-97ba-ca48e41a44b8",
  "meta": {
    "instanceId": "448f766a569d9f99225f92707c70839acb353c0f2aed31023e195f8796fef2cd"
  },
  "id": "KDXoO0LbUHerLKP-f1Ono",
  "tags": []
}