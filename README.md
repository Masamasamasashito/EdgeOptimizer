# Edge Optimizer

**GEOÂàÜÊï£ √ó „Ç¢„Çª„ÉÉ„ÉàWarmup √ó URL„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ √ó „Éê„É™„Ç¢„É≥„ÉàÂØæÂøú √ó 4Â±§„Çª„Ç≠„É•„É™„ÉÜ„Ç£**„ÇíÂÖº„Å≠ÂÇô„Åà„Åü„ÄÅÂîØ‰∏Ä„ÅÆCDN„Ç≠„É£„ÉÉ„Ç∑„É•Warmup OSS

CRAFTED BY „Å´„Åó„É©„Éú (https://4649-24.com)

## What is Edge Optimizer?

**Edge Optimizer (EO)** „ÅØ„ÄÅAWS Lambda / Azure Functions / GCP Cloud Run / Cloudflare Workers „ÅÆ„Çµ„Éº„Éê„Éº„É¨„ÇπÈñ¢Êï∞„Åã„ÇâGEOÂàÜÊï£„É™„ÇØ„Ç®„Çπ„Éà„ÇíÂÆüË°å„Åó„ÄÅ‰∏ñÁïå‰∏≠„ÅÆCDN„Ç®„ÉÉ„Ç∏„Å´„Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÁîüÊàê„Åß„Åç„ÇãOSS„Åß„Åô„ÄÇ

n8nÔºà„ÉØ„Éº„ÇØ„Éï„É≠„Éº„Ç™„Éº„Ç±„Çπ„Éà„É¨„Éº„Ç∑„Éß„É≥Ôºâ+ PlaywrightÔºà„Éò„ÉÉ„Éâ„É¨„Çπ„Éñ„É©„Ç¶„Ç∂Ôºâ+ Request EngineÔºà„Çµ„Éº„Éê„Éº„É¨„ÇπÈñ¢Êï∞Ôºâ„ÅÆ3Â±§„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„Åß„ÄÅ„É°„Ç§„É≥„Éâ„Ç≠„É•„É°„É≥„ÉàÔºãÂÖ®„Ç¢„Çª„ÉÉ„ÉàÔºàCSS/JS/ÁîªÂÉè/„Éï„Ç©„É≥„ÉàÔºâ„Çí„ÄÅ‰ªªÊÑè„ÅÆUser-Agent/Accept-Language„Éê„É™„Ç¢„É≥„Éà„Åß„ÄÅ‰∏ñÁïå‰∏≠„Åã„ÇâWarmup„Åß„Åç„Åæ„Åô„ÄÇ

## „Åì„Çì„Å™ÁµåÈ®ì„ÄÅ„ÅÇ„Çä„Åæ„Åõ„Çì„ÅãÔºü

> üí∏ Â∫ÉÂëä„Ç≠„É£„É≥„Éö„Éº„É≥ÈñãÂßãÁõ¥Âæå„ÄÅLCP„Åå3ÁßíË∂Ö„Åà„Å¶CVR„ÅåÊøÄÊ∏õ„Åó„Åü
>
> üò± „Éá„Éó„É≠„Ç§Áõ¥Âæå„ÅÆÂàùÂõû„Ç¢„ÇØ„Çª„Çπ„Å†„ÅëÁï∞Â∏∏„Å´ÈÅÖ„ÅÑÔºà„Åß„ÇÇÊîæÁΩÆ„Åó„Å¶„ÇãÔºâ
>
> üåè „ÄåÊµ∑Â§ñ„Åã„Çâ„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåÈÅÖ„ÅÑ„Äç„Å®„ÇØ„É¨„Éº„É†„ÅåÊù•„Åü„Åå„ÄÅÊâì„Å§Êâã„Åå„Å™„ÅÑ
>
> üìä CDNÂÖ•„Çå„Åü„ÅÆ„Å´„Ç≠„É£„ÉÉ„Ç∑„É•„Éí„ÉÉ„ÉàÁéá„Åå‰∏ä„Åå„Çâ„Å™„ÅÑ„ÄÅÂéüÂõ†‰∏çÊòé

**ÂéüÂõ†„ÅØ„Åô„Åπ„Å¶Âêå„ÅòÔºöCDN„Ç®„ÉÉ„Ç∏„Å´„Ç≠„É£„ÉÉ„Ç∑„É•„ÅåÁÑ°„ÅÑ**

Êó¢Â≠ò„ÅÆCache Warmer„ÅØ„Äå„É°„Ç§„É≥„Éâ„Ç≠„É•„É°„É≥„Éà„Å†„Åë„Äç„ÄåÂçò‰∏Ä„É≠„Ç±„Éº„Ç∑„Éß„É≥„Äç„Åó„ÅãWarmup„Åó„Åæ„Åõ„Çì„ÄÇEdge Optimizer„ÅØ„ÄÅ**‰∏ñÁïå‰∏≠„ÅÆ„Ç®„ÉÉ„Ç∏„Å´„ÄÅÂÖ®„Ç¢„Çª„ÉÉ„Éà„ÇÇ„ÄÅÊÉ≥ÂÆö„Åï„Çå„Åü„Éö„É´„ÇΩ„Éä„ÅÆ„Éê„É™„Ç¢„É≥„Éà„Åß‰∫ãÂâç„Å´Warmup**„Åß„Åç„Åæ„Åô„ÄÇ

## Ê©üËÉΩÊØîËºÉ

| Ê©üËÉΩ | Êó¢Â≠òCache Warmer | Edge Optimizer |
|-----|------------------|----------------|
| **„Ç¢„Çª„ÉÉ„ÉàWarmup** | ‚ùå „É°„Ç§„É≥„Éâ„Ç≠„É•„É°„É≥„ÉàÊ≠¢„Åæ„Çä | ‚úÖ CSS/JS/ÁîªÂÉè/„Éï„Ç©„É≥„ÉàÂÖ®ÂØæÂøú |
| **GEOÂàÜÊï£„É™„ÇØ„Ç®„Çπ„Éà** | ‚ùå Âçò‰∏Ä„É≠„Ç±„Éº„Ç∑„Éß„É≥ | ‚úÖ AWS/Azure/GCP/CF Workers |
| **ÁèæÂú∞CDN„Ç®„ÉÉ„Ç∏Warmup** | ‚ùå „ÉÑ„Éº„É´ÂÆüË°åÂú∞„ÅÆ„Åø | ‚úÖ „É¶„Éº„Ç∂„Éº„ÅåÂ±Ö„ÇãÁèæÂú∞„Ç®„ÉÉ„Ç∏„ÇíÁõ¥Êé•Warmup |
| **URL„Éï„Ç£„É´„Çø„É™„É≥„Ç∞** | ‚ùå XML„Çµ„Ç§„Éà„Éû„ÉÉ„ÉóÂÖ®‰ª∂ | ‚úÖ „Ç≠„É£„ÉÉ„Ç∑„É•„Åô„Åπ„ÅçURL„ÅÆ„Åø„Å´„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ |
| **„Éê„É™„Ç¢„É≥„ÉàÂØæÂøú** | ‚ùå Âõ∫ÂÆöUA or ÁÑ°ÈÖçÊÖÆ | ‚úÖ User-Agent/Accept-LanguageËá™Áî±Ë®≠ÂÆö |
| **„Çª„Ç≠„É•„É™„ÉÜ„Ç£** | ‚ö†Ô∏è Á∞°ÊòìÁöÑ | ‚úÖ 4Â±§ÔºàDNSË™çË®º/„ÇØ„É©„Ç¶„ÉâË™çË®º/„Éà„Éº„ÇØ„É≥ÁÖßÂêà/„É¨„Éº„ÉàÂà∂Âæ°Ôºâ |
| **„Ç™„Éº„Ç±„Çπ„Éà„É¨„Éº„Ç∑„Éß„É≥** | ‚ùå „Å™„Åó | ‚úÖ n8n„Åß„Éé„Éº„Ç≥„Éº„Éâ/„É≠„Éº„Ç≥„Éº„ÉâËá™ÂãïÂåñ |
| **IaC** | ‚ùå „Å™„Åó | ‚úÖ CloudFormation, Bicep, GitHub Actions |

## ÂØæÂøúCDN

Request Engine„ÅØ„É¨„Çπ„Éù„É≥„Çπ„Éò„ÉÉ„ÉÄ„Éº„Åã„ÇâCDN„ÇíËá™ÂãïÊ§úÂá∫„Åó„Åæ„Åô„ÄÇ

| CDN | Ê§úÂá∫„Éò„ÉÉ„ÉÄ„Éº |
|-----|------------|
| Cloudflare | `cf-ray` |
| AWS CloudFront | `x-amz-cf-id` |
| Azure Front Door | `x-azure-ref` |
| Akamai | `x-akamai-request-id` |
| Fastly | `x-served-by` |
| Vercel | `x-vercel-cache` |
| GCP CDN | `server: google-edge-cache` |
| NitroCDN | `x-nitro-cache` |
| RabbitLoader | `x-rl-cache` |

## „Ç≥„Çπ„Éà

- **Á∂≠ÊåÅË≤ª**: „Çº„É≠ÂÜÜÔºàOSS/„Çª„É´„Éï„Éõ„Çπ„ÉÜ„Ç£„É≥„Ç∞Ôºâ
- **Á®ºÂÉç„Ç≥„Çπ„Éà**: „Çµ„Éº„Éê„Éº„É¨„ÇπÈñ¢Êï∞„ÅÆÂæìÈáèË™≤Èáë + self hosted n8nÂÆüË°åÁí∞Â¢É

# Quick Start

Pls create work directory.

EX)
```
mkdir ~/work/docker | cd
```

## 1. git clone
```
git clone https://github.com/Masamasamasashito/EdgeOptimizer.git
```

## 2. Get Ready EO_Infra_Docker/.env

All Docker Compose related files (docker-compose.yml, env.example, caddy/Caddyfile, and service-specific Dockerfiles) are located in the `EO_Infra_Docker` directory.

```
cd EdgeOptimizer/EO_Infra_Docker
cp env.example .env
```

## 3. Generate security keys on EO_Infra_Docker/.env (Crucial step!)

Run the command below for your OS in your terminal to append secrets to `EO_Infra_Docker/.env` (You only need to do this once)

**Note:** Make sure you are in the `EO_Infra_Docker` directory or adjust the paths accordingly.

üçé macOS / üêß Linux (Copy & Paste into Terminal)
```
cd EO_Infra_Docker
echo "" >> .env
echo "N8N_ENCRYPTION_KEY=$(openssl rand -hex 32)" >> .env
echo "N8N_EO_REQUEST_SECRET=$(openssl rand -hex 32)" >> .env
echo "POSTGRES_PASSWORD=$(openssl rand -base64 32 | tr -d '/+=')" >> .env
echo "REDIS_PASSWORD=$(openssl rand -base64 32 | tr -d '/+=')" >> .env
echo "SEARXNG_CONTAINER_SECRET=$(openssl rand -hex 32)" >> .env
```

ü™ü Windows PowerShell (Copy & Paste into PowerShell)
```
cd EO_Infra_Docker
"" | Add-Content .env
$bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $hex = -join ($bytes | ForEach-Object { $_.ToString("x2") }); "N8N_ENCRYPTION_KEY=$hex" | Add-Content .env
$bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $hex = -join ($bytes | ForEach-Object { $_.ToString("x2") }); "N8N_EO_REQUEST_SECRET=$hex" | Add-Content .env
$bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $base64 = [Convert]::ToBase64String($bytes) -replace '[\/+=]', ''; "POSTGRES_PASSWORD=$base64" | Add-Content .env
$bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $base64 = [Convert]::ToBase64String($bytes) -replace '[\/+=]', ''; "REDIS_PASSWORD=$base64" | Add-Content .env
$bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $hex = -join ($bytes | ForEach-Object { $_.ToString("x2") }); "SEARXNG_CONTAINER_SECRET=$hex" | Add-Content .env
```

## 4. Environment Variable Access in n8n Workflows

**Important**: To use environment variables (e.g., `{{ $env.N8N_EO_REQUEST_SECRET }}`) in n8n workflows, you need to configure environment variable access permissions.

### Configuration

#### 1. Set Environment Variable in `EO_Infra_Docker/.env` File

The `N8N_EO_REQUEST_SECRET` value must be set in `EO_Infra_Docker/.env` file. This is automatically generated when you run the commands in **Section 3** above. If you need to set it manually, add the following line to your `EO_Infra_Docker/.env` file:

```
N8N_EO_REQUEST_SECRET=your_secret_value_here
```

#### 2. Docker Compose Configuration

The `EO_Infra_Docker/docker-compose.yml` file includes the following settings:

```yaml
N8N_EO_REQUEST_SECRET: ${N8N_EO_REQUEST_SECRET}
N8N_BLOCK_ENV_ACCESS_IN_NODE: false
```

- **`N8N_EO_REQUEST_SECRET: ${N8N_EO_REQUEST_SECRET}`**: This reads the value from the `EO_Infra_Docker/.env` file (set in step 1) and passes it to the n8n container as an environment variable. It can then be accessed in workflows using `{{ $env.N8N_EO_REQUEST_SECRET }}`.
- **`N8N_BLOCK_ENV_ACCESS_IN_NODE: false`**: This setting allows workflows to access environment variables. Setting it to `true` would block access to all environment variables from expressions and Code nodes.

### Important Notes

- **Preview Limitation**: When previewing expressions in the n8n UI (manual execution), you may see an "access to env vars denied" error. This is a known limitation and can be ignored. Environment variables work correctly during actual workflow execution (automated runs).
- **Reference**: For more details, see:
  - [n8n Official Documentation: Environment Variables Security](https://docs.n8n.io/hosting/configuration/environment-variables/security/)
  - [n8n Community Discussion: No access to $env](https://community.n8n.io/t/no-access-to-env/20665)

### Usage in Workflows

In your n8n workflows (e.g., the "170 n8n RequestSecret Token Generator" node), you can access environment variables using:

```
{{ $json.url }}{{ $env.N8N_EO_REQUEST_SECRET }}
```

This is required for the Request Engine token generation process.

## 5. Start Containers

Navigate to the `EO_Infra_Docker` directory and start the containers:

```
cd EO_Infra_Docker
docker compose up -d
```

> [!TIP]
> **Running Multiple Instances / Avoiding Port Conflicts**
> By default, ports are bound to `127.0.0.1` (localhost) to ensure security and reduce port conflicts on your host machine.
> You can customize this behavior or the specific ports used by editing the `EO_Infra_Docker/.env` file (e.g., `DOCKER_HOST_BIND_ADDR`, `DOCKER_HOST_PORT_N8N_CONTAINER`).
>
> **‚ö†Ô∏è CRITICAL: Running Multiple Local Environments**
> If you want to run multiple environments on the same machine:
> 1. **Change ALL VOLUME NAMES** in `EO_Infra_Docker/.env` (e.g., add `_v2` suffix) to prevent data collision
> 2. **Change `DOCKER_HOST_BIND_ADDR`** to a different IP (e.g., `127.0.0.2`, `127.0.0.3`) to avoid port binding conflicts
> 3. **Update `N8N_WEBHOOK_URL`** to match the new IP address
> 
> **WARNING**: If you skip changing volume names, multiple environments will share the SAME volumes, causing data corruption, loss, or overwriting. One environment's data may be completely lost when the other is stopped/removed.
> 
> See `EO_Infra_Docker/env.example` for detailed instructions in the "ADVANCED: Running Multiple Local Environments" section.

### Production Setup (with Caddy)
To start with Caddy (Reverse Proxy), use the `prod` profile.
*Ensure `PRODUCTION=true` and valid domain/email settings in `EO_Infra_Docker/.env` if enabling secure cookies/SSL.*

```
cd EO_Infra_Docker
docker compose --profile prod up -d
```

## 6. n8n Launch Check(local self-hosted)

open : [http://localhost:5678](http://localhost:5678)

# „ÄêRecommended to try„Äën8n Queue Mode Test

we recommend using the n8n Queue Mode Test as a measure to prevent memory exhaustion in n8n.
[n8nQueueModeTest](n8nQueueModeTest)

# 7. Setup Request Engine

Request Engine is an essential component running on Serverless Computing, designed for purposes such as cache performance verification from edge locations, cache warmup, and security checks.

üëâ See detailed setup guide here:
- [RE_README.md](RequestEngine/RE_README.md) - Request EngineÂÖ®‰Ωì
- [LAMBDA_README.md](RequestEngine/aws_lambda/apne1/LAMBDA_README.md) - AWS Lambda
- [LAMBDA_CFN_README.md](RequestEngine/aws_lambda/CFn/LAMBDA_CFN_README.md) - AWS Lambda CFn üëà Recommend!
- [AZFUNC_README.md](RequestEngine/azure_functions/jpeast/AZFUNC_README.md) - Azure Functions
- [AZFUNC_BICEP_README.md](RequestEngine/azure_functions/bicep/AZFUNC_BICEP_README.md) - Azure Bicep
- [CFWORKER_README.md](RequestEngine/cloudflare_workers/global/CFWORKER_README.md) - Cloudflare Workers
- [RUN_README.md](RequestEngine/gcp_cloudrun/ane1/RUN_README.md) - GCP Cloud Run


