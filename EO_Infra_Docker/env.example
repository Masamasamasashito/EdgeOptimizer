# ==============================================================================
# 🚀 .env GET READY: First Trial Setup (Quick Start)
# ==============================================================================
# HOW TO:
# 1. Copy this file to a new file named ".env"
#    Command: cp env.example .env
#
# 2. Generate security keys and passwords (Crucial step!)
#    Run the command below for your OS in your terminal to append secrets to .env.
#    (You only need to do this once.)
# ==============================================================================

# --- 🍎 macOS / 🐧 Linux (Copy & Paste into Terminal) ---
# echo "" >> .env
# echo "N8N_ENCRYPTION_KEY=$(openssl rand -hex 32)" >> .env
# echo "N8N_EO_REQUEST_SECRET=$(openssl rand -hex 32)" >> .env
# echo "POSTGRES_PASSWORD=$(openssl rand -base64 32 | tr -d '/+=')" >> .env
# echo "REDIS_PASSWORD=$(openssl rand -base64 32 | tr -d '/+=')" >> .env
# echo "SEARXNG_CONTAINER_SECRET=$(openssl rand -hex 32)" >> .env

# --- 🪟 Windows PowerShell (Copy & Paste into PowerShell) ---
# "" | Add-Content .env
# $bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $hex = -join ($bytes | ForEach-Object { $_.ToString("x2") }); "N8N_ENCRYPTION_KEY=$hex" | Add-Content .env
# $bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $hex = -join ($bytes | ForEach-Object { $_.ToString("x2") }); "N8N_EO_REQUEST_SECRET=$hex" | Add-Content .env
# $bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $base64 = [Convert]::ToBase64String($bytes) -replace '[\/+=]', ''; "POSTGRES_PASSWORD=$base64" | Add-Content .env
# $bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $base64 = [Convert]::ToBase64String($bytes) -replace '[\/+=]', ''; "REDIS_PASSWORD=$base64" | Add-Content .env
# $bytes = New-Object byte[] 32; (New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes); $hex = -join ($bytes | ForEach-Object { $_.ToString("x2") }); "SEARXNG_CONTAINER_SECRET=$hex" | Add-Content .env

# ==============================================================================
# 📦 ADVANCED: Running Multiple Local Environments
# ==============================================================================
# If you want to run a second Environment alongside an existing one:
# 1. Create a separate directory for the new environment.
# 2. Change the HOST PORTS in .env to avoid conflicts (e.g., add 10000).
#    - DOCKER_HOST_PORT_N8N_CONTAINER      (e.g., 5678 -> 15678)
#    - DOCKER_HOST_PORT_POSTGRES_CONTAINER (e.g., 5432 -> 15432)
#    - DOCKER_HOST_PORT_REDIS              (e.g., 6379 -> 16379)
#    - DOCKER_HOST_PORT_PLAYWRIGHT         (e.g., 3000 -> 13000)
#
# 3. CRITICAL: Change ALL VOLUME NAMES in .env to prevent data collision (e.g., add _v2).
#    ⚠️ WARNING: If you skip this step, multiple environments will share the SAME volumes,
#    causing data corruption, loss, or overwriting. For example:
#    - Environment 1 and Environment 2 will use the same PostgreSQL database
#    - Workflows, credentials, and execution data will be mixed or overwritten
#    - One environment's data may be completely lost when the other is stopped/removed
#    - N8N_VOLUME_NAME                     (e.g., eoN8nDataVolume_v2)
#    - PLAYWRIGHT_VOLUME_NAME              (e.g., eoPlaywrightDataVolume_v2) *If enabled
#    - POSTGRES_VOLUME_NAME                (e.g., eoPostgresDataVolume_v2)
#    - POSTGRES_USERHOME_VOLUME_NAME       (e.g., eoPostgresUserHomeVolume_v2)
#    - REDIS_VOLUME_NAME                   (e.g., eoRedisDataVolume_v2)
#    - CADDY_VOLUME_NAME                   (e.g., eoCaddyDataVolume_v2)
#    - CADDY_CONFIG_VOLUME_NAME            (e.g., eoCaddyConfigVolume_v2)
#    - SEARXNG_CACHE_VOLUME_NAME           (e.g., eoSearxngCacheVolume_v2)
#
# 4. IMPORTANT: Change DOCKER_HOST_BIND_ADDR to a different IP address
#    (e.g., 127.0.0.2, 127.0.0.3, etc.) to avoid port binding conflicts
#    when running multiple environments in the same browser on the same machine.
#    - DOCKER_HOST_BIND_ADDR                (e.g., 127.0.0.1 -> 127.0.0.2)
#    - Also update N8N_WEBHOOK_URL to match the new IP address
#      (e.g., http://127.0.0.2:15678/ instead of http://localhost:15678/)
#
# 5. Access the new instance via the NEW PORT and IP ADDRESS.
#    - URL: http://127.0.0.2:15678/ (instead of the default http://localhost:5678/)
#
# 💡 TIP: Look for "# 🔄 IF MULTI-ENV:" comments in the configuration section below
#    to quickly identify all items that need to be changed for multiple environments.
# ==============================================================================

# ==============================================================================
# ⚙️ Configuration
# ==============================================================================

# ------------------------------------------------------------------------------
# Global Settings
# ------------------------------------------------------------------------------
# Define the timezone once for all services
COMMON_TIMEZONE=Asia/Tokyo

# ------------------------------------------------------------------------------
# COMMON_EO Settings ( docker-compose.yml ＆ Dockerfile )
# ------------------------------------------------------------------------------
# Environment variable passing flow (docker-compose.yml and Dockerfile)
# 1. .env environment variable COMMON_EO_XXX_YYY
# 2. → docker-compose.yml's ${COMMON_EO_XXX_YYY:-sample_value}
# 3. → docker-compose.yml converts to Dockerfile's ARG variable name (removes COMMON_ prefix)
#    Example: COMMON_EO_XXX_YYY → EO_XXX_YYY
# 4. → Dockerfile uses the converted name (e.g., ARG EO_XXX_YYY → ${EO_XXX_YYY})
#    If a value is passed from docker-compose.yml, that value is used
#    If no value is passed, the default value specified in Dockerfile is used

# ------------------------------------------------------------------------------
# COMMON_EO Docker Official Image and Versions(TAG)
# ------------------------------------------------------------------------------
# Pin versions for stability in production

# n8n Official Image
# Basic functionality verified version `2.1.2`
COMMON_EO_DOCKER_N8N_IMAGE=n8nio/n8n
COMMON_EO_DOCKER_N8N_IMAGE_TAG=latest

# Postgres Official Image
# Basic functionality verified version `18.1`
COMMON_EO_DOCKER_POSTGRES_IMAGE=postgres
COMMON_EO_DOCKER_POSTGRES_IMAGE_TAG=alpine

# Redis Official Image
# Basic functionality verified version `8.4.0`
COMMON_EO_DOCKER_REDIS_IMAGE=redis
COMMON_EO_DOCKER_REDIS_IMAGE_TAG=alpine

# Caddy Official Image
COMMON_EO_DOCKER_CADDY_IMAGE=caddy
COMMON_EO_DOCKER_CADDY_IMAGE_TAG=alpine

# Microsoft Playwright Official Image
# Basic functionality verified version `noble ( Ubuntu 24.04 LTS )`
# focal: Ubuntu 20.04 LTS
# jammy: Ubuntu 22.04 LTS
# noble: Ubuntu 24.04 LTS
COMMON_EO_DOCKER_PLAYWRIGHT_IMAGE=mcr.microsoft.com/playwright
COMMON_EO_DOCKER_PLAYWRIGHT_IMAGE_TAG=noble

# SearXNG Official Image
# Basic functionality verified version `latest`
COMMON_EO_DOCKER_SEARXNG_IMAGE=docker.io/searxng/searxng
COMMON_EO_DOCKER_SEARXNG_IMAGE_TAG=latest

# ------------------------------------------------------------------------------
# 1. n8n Core Settings
# ------------------------------------------------------------------------------
# [NOTE] If you ran the commands above, N8N_ENCRYPTION_KEY is already at the bottom of this file.
# Uncomment below ONLY if you want to set a fixed manual key.
# N8N_ENCRYPTION_KEY=your_manual_key_here

# 🔄 IF MULTI-ENV: Change this port when running multiple environments (e.g., 5678 -> 15678)
DOCKER_HOST_PORT_N8N_CONTAINER=5678
N8N_CONTAINER_LISTEN_PORT=5678 # It is not recommended to change this port ( Defined by container image )
# HOSTNAME_N8N_CONTAINER is used internally by n8n (N8N_HOST environment variable)
# This is mainly for internal container hostname resolution and can remain as 'localhost'
# even if DOCKER_HOST_BIND_ADDR is set to a specific IP (e.g., 127.0.0.2)
# The actual external webhook URL is controlled by N8N_WEBHOOK_URL below
HOSTNAME_N8N_CONTAINER=localhost
# 🔄 IF MULTI-ENV: Change volume name to prevent data collision (e.g., eoN8nDataVolume_v2)
N8N_VOLUME_NAME=eoN8nDataVolume

# Network Binding
# Default to 127.0.0.1 to avoid exposing ports publicly and to prevent conflicts
# 🔄 IF MULTI-ENV: Change to different IP (e.g., 127.0.0.2, 127.0.0.3) when running multiple environments
# If you change this value, also update N8N_WEBHOOK_URL to use the same address
# (e.g., if DOCKER_HOST_BIND_ADDR=127.0.0.2, then N8N_WEBHOOK_URL=http://127.0.0.2:5678/)
DOCKER_HOST_BIND_ADDR=127.0.0.1

# Webhook Base URL
# Local default:
# 🔄 IF MULTI-ENV: Update to match DOCKER_HOST_BIND_ADDR and DOCKER_HOST_PORT_N8N_CONTAINER
# IMPORTANT: If DOCKER_HOST_BIND_ADDR is set to a specific IP (e.g., 127.0.0.2),
# use that IP address instead of 'localhost' to match the port binding
N8N_WEBHOOK_URL=http://localhost:5678/
# Production / Caddy (Must use https):
# N8N_WEBHOOK_URL=https://automation.example.com/

N8N_PROTOCOL=http

# ------------------------------------------------------------------------------
# 2. n8n (Security)
# ------------------------------------------------------------------------------
# [NOTE] If you ran the commands above, N8N_EO_REQUEST_SECRET is already set.
# Uncomment below ONLY for manual setup.
# N8N_EO_REQUEST_SECRET=your_manual_secret_here

#　CF Cache Purge
N8N_EO_CF_CACHE_PURGE_ZONE_ID: ${N8N_EO_CF_CACHE_PURGE_ZONE_ID}
N8N_EO_CF_CACHE_PURGE_USER_API_TOKEN: ${N8N_EO_CF_CACHE_PURGE_USER_API_TOKEN}

# ------------------------------------------------------------------------------
# 3. n8n Execution Data Pruning (Maintenance)
# ------------------------------------------------------------------------------
N8N_EXECUTIONS_DATA_PRUNE=true
N8N_EXECUTIONS_DATA_MAX_AGE=168       # 168 hours = 7 days
N8N_EXECUTIONS_DATA_PRUNE_MAX_COUNT=5000

# ------------------------------------------------------------------------------
# 4. Playwright (Browser Automation)
# Edge Optimizer accuracy improves, but `docker compose up -d` takes longer, increasing the startup time from 15 to 25 minutes.
# ------------------------------------------------------------------------------
# Host-side port (✅ Can be changed if it conflicts with other projects)
# 🔄 IF MULTI-ENV: Change this port when running multiple environments (e.g., 3000 -> 13000)
DOCKER_HOST_PORT_PLAYWRIGHT=3000
# Container internal port (✅ Can be changed! EO_Infra_Docker\playwright\server.js reads the environment variable, so both ports can be changed to the same value)
# If it conflicts with other projects, change both values simultaneously (e.g., 3001)
PLAYWRIGHT_CONTAINER_LISTEN_PORT=3000
# 🔄 IF MULTI-ENV: Change volume name to prevent data collision (e.g., eoPlaywrightDataVolume_v2)
PLAYWRIGHT_VOLUME_NAME=eoPlaywrightDataVolume

# ------------------------------------------------------------------------------
# 5. Postgres Database
# ------------------------------------------------------------------------------
# [NOTE] If you ran the commands above, POSTGRES_PASSWORD is already set.
# Uncomment below ONLY for manual setup.
# POSTGRES_PASSWORD=your_manual_password_here

POSTGRES_USER=n8n
POSTGRES_DB=n8n
# 🔄 IF MULTI-ENV: Change this port when running multiple environments (e.g., 5432 -> 15432)
DOCKER_HOST_PORT_POSTGRES_CONTAINER=5432
POSTGRES_CONTAINER_LISTEN_PORT=5432 # It is not recommended to change this port ( Defined by container image )
# 🔄 IF MULTI-ENV: Change volume name to prevent data collision (e.g., eoPostgresDataVolume_v2)
POSTGRES_VOLUME_NAME=eoPostgresDataVolume
# 🔄 IF MULTI-ENV: Change volume name to prevent data collision (e.g., eoPostgresUserHomeVolume_v2)
POSTGRES_USERHOME_VOLUME_NAME=eoPostgresUserHomeVolume

# ------------------------------------------------------------------------------
# 6. Redis ( Queue / Cache )
# ------------------------------------------------------------------------------
# [NOTE] If you ran the commands above, REDIS_PASSWORD is already set.
# Uncomment below ONLY for manual setup.
# REDIS_PASSWORD=your_manual_password_here
# 🔄 IF MULTI-ENV: Change this port when running multiple environments (e.g., 6379 -> 16379)
DOCKER_HOST_PORT_REDIS=6379
REDIS_CONTAINER_LISTEN_PORT=6379 # It is not recommended to change this port ( Defined by container image )
REDIS_DB=0
# 🔄 IF MULTI-ENV: Change volume name to prevent data collision (e.g., eoRedisDataVolume_v2)
REDIS_VOLUME_NAME=eoRedisDataVolume
# ------------------------------------------------------------------------------
# 7. SearXNG
# ------------------------------------------------------------------------------
# DOCKER_HOST_PORT_SEARXNG_CONTAINER=8080
# 🔄 IF MULTI-ENV: Change this port when running multiple environments (e.g., 8080 -> 18080)
DOCKER_HOST_PORT_SEARXNG_CONTAINER=8080
SEARXNG_CONTAINER_LISTEN_PORT=8080  # It is not recommended to change this port ( Defined by container image )
SEARXNG_HOSTNAME=search.example.com
SEARXNG_UWSGI_WORKERS=4
SEARXNG_UWSGI_THREADS=4

# [NOTE] If you ran the commands above, SEARXNG_CONTAINER_SECRET is already set.
# Uncomment below ONLY for manual setup.
# SEARXNG_CONTAINER_SECRET=changeme_64char_hex_string

# 🔄 IF MULTI-ENV: Change volume name to prevent data collision (e.g., eoSearxngCacheVolume_v2)
SEARXNG_CACHE_VOLUME_NAME=eoSearxngCacheVolume

# ------------------------------------------------------------------------------
# 8. Caddy (Web Server / Reverse Proxy)
# ------------------------------------------------------------------------------
# 🔄 IF MULTI-ENV: Change volume name to prevent data collision (e.g., eoCaddyDataVolume_v2)
CADDY_VOLUME_NAME=eoCaddyDataVolume
# 🔄 IF MULTI-ENV: Change volume name to prevent data collision (e.g., eoCaddyConfigVolume_v2)
CADDY_CONFIG_VOLUME_NAME=eoCaddyConfigVolume

# ------------------------------------------------------------------------------
# 9. Deployment Profiles
# ------------------------------------------------------------------------------
# Set to 'true' for Production (Enables Secure Cookies, requires HTTPS)
PRODUCTION=false
# N8N_PUBLIC_HOSTNAME=automation.example.com
# ACME_EMAIL=you@example.com

# ------------------------------------------------------------------------------
# Generate security keys and passwords Command Results
# ------------------------------------------------------------------------------





